<html>
<head>
<title>EOR: Keeper</title>
</head>

<BODY BGCOLOR="#ffeedd" text="#000000" link="#0000ee" vlink="#551a8b" alink="#ff0000"><table><tr valign=top><td width="10%">&nbsp;</td><td><div class=nocss><br class=nocss>&nbsp;<br class=nocss>&nbsp;</div>
<div class=KeyName>
  [<em><a href="../Cover.html">Return to Top</a></em>]
  [<em><a href="00Concepts.html">Concepts</a></em>]
  <div align=right>
    <H2>EROS Object Reference</H2>
    <H2>Concepts</H2>
  </div>
  <h2>Keeper</h2>
  <em>D R A F T</em>
  <hr>
</div>
<div class=KeyDescrip>
  <h3>Description</h3>
  <p> A <strong>keeper</strong> is a program that responds to faults
  generated by an executing program.  In EROS, faults are of two
  types:
  <ul>
    <li> Execution faults, which occur as the result of executing an
	 illegal or privileged instruction, an instruction designated
	 by the architecture to generate a fault, or (on some
	 machines) a coprocessor instruction that must be emulated.
	 <p>
    <li> Memory faults, which occur as a consequence of performing a
	 data reference or an accessing call to an address space.
	 <p> 
  </ul>
  <p> When a process attempts to execute an instruction that causes an
  execution fault, the program is halted and the kernel invokes the
  application's <strong>process keeper</strong> on it's behalf, passing
  a message that encapsulates the fault information.  The process
  keeper is invoked with <code>OC = ~0u</code>, and is passed a
  structure containing the fault code, the fault information (the
  program counter or address of the fault), and the active fixed-point
  register values at the time of the fault.  The process keeper can
  repair the fault and resume the process, start a debugger, or take
  any other appropriate action (including doing nothing).
  <p> When a process accesses an invalid address, or performs a write
  to a read-only address, the program is halted and the kernel invokes
  the <strong>address space keeper</strong> associated with that address.
  The address space keeper is invoked with <code>OC = ~0u</code>, and is
  passed a structure containing the fault code and the offset
  (relative to the root of the kept address space) at which the fault
  occurred.  EROS supports address spaces of up to 2<sup>96</sup> bits, so
  the delivered offset is a 96 bit value.  aThe address space keeper can
  repair the fault, pass the fault to the process keeper, or take some
  other action.  If no address space keeper is defined, the process keeper is
  invoked.
  <p> Separation of execution and memory faults allows user-level
  applications to provide policies customarily implemented by the
  kernel.  Such policies include
  <ul>
    <li> Copy-on-write (virtual copy) address spaces.  An address space keeper can
	 implement copy on write by provding a read-only background
	 address space.
    <li> Demand zero address spaces.  An address space keeper can implement
	 demand-zero address spaces by satisfying faulting references with
	 zero pages.
    <li> Transactional shared memory.  An address space keeper can implement
	 release consistency by revising the mappings in an address space to
	 allow at most one writer of any page.
  </ul>
  <p> Faults that are handled by a keeper are transparent to
  the application.  The application proceeds, restarting the
  instruction that generated the fault.
  <h3>Standard Address Space Keepers</h3>
  <p> EROS provides two standard address space keepers:
  <table>
    <tr>
      <td><strong>VCSK</strong></td>
      <td>The <a href="../standard/VirtCopySeg.html">virtual copy
	address space</a> keeper, which provides "copy on write"
	services.</td>
    </tr>
    <tr>
      <td><strong>FSK</strong></td>
      <td>The <a href="../standard/FreshSeg.html">fresh address space</a>
	keeper, which provides "demand zero" services.</td>
    </tr>
  </table>
  <p> Invocations on kept address spaces are reflected to their keeper, so
  in addition to fault handling, the keeper is responsible for
  providing the standard address space operations and (possibly) additional
  operations.  Both the fresh address space and virtual copy address space keepers
  provide <em>destroy</em>, <em>truncate</em>, and <em>shorten</em>
  operations.  Refer to the respective documentation pages for the
  request details.
  <h3>Standard Process Keepers</h3>
  <p> EROS provides a standard process keeper supporting debugging
  services.  This keeper provides emulation for any necessary
  coprocessor instructions, and invokes the EROS process debugger when
  a process fault occurs.
</div>
<hr>
<em>Copyright 1998 by Jonathan Shapiro.  All rights reserved.  For terms of 
redistribution, see the 
<a href="../../../legal/license/GPL.html">GNU General Public License</a></em>
</td><td width="10%">&nbsp;</td></tr></table></BODY>
</html>
