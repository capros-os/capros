<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0 Level 1//EN">
<HTML>
  <HEAD>
    <TITLE>Getting and Building CapROS</TITLE>
  </HEAD>
  <BODY BGCOLOR="#fff0ff" text="#000000" link="#0000ee" vlink="#551a8b" alink="#ff0000">
	  <div class=nocss>
	    <br class=nocss>&nbsp;
	      <br class=nocss>&nbsp;
	  </div>
	  <center>
	    <H1>Getting and Building CapROS</H1>
	  </center>
	  <h1>1. Obtaining CapROS</h1>
	  <p>
	    If you just want to have a
	    look at the code, you can simply go to the 
	    <a href="http://sourceforge.net/projects/capros/">
	    Project page</a>
            and click on "Browse CVS".
            SourceForge also has instructions for getting
            anonymous access to CVS. 
	  </p>
	  <h1>2. Building CapROS</h1>
	  <p>
          These instructions are for building for the Intel architecture.
          A port also exists for the ARM architecture; see
          <a href="#ARMBuild">below</a>. 
	  </p>
          <h2>2.1. Package Requirements</h2>
	  <p>
            CapROS is built using Linux. If your system doesn't have the
            following packages, you may need to obtain and install them. 
            You must also have GRUB installed, because CapROS is
            loaded by GRUB using the Multiboot specification.
          </p>
          <h3>2.1.2. For Fedora Core 6</h3>
            <ul>
            <li>transfig
            </ul>
          <h3>2.1.3. For Debian Sarge</h3>
            <ul>
            <li>libgmp3-dev -- Multiprecision arithmetic library</li>
            <li>binutils-dev -- for libbfd</li>
            <li>gawk</li>
            </ul>
	  <h2>2.2. Building the Cross Compilation Tools</h2>
	  <p>
            CapROS uses its own cross-compilation tools 
            for stability.
            We acknowledge and thank the Coyotos project
            at Johns Hopkins Univerity for hosting these tools. 
      <h3>2.2.1 Setting up on Linux/YUM Systems</h3>
      <p>
	If you are running Fedora Core 6, you can add the YUM
	repository to your <tt>yum</tt> and
	<tt>up2date</tt> configurations by executing:
      </p>
      <pre>
su -c 'rpm -ivh http://www.coyotos.org/YUM/coyotos/6/i386/Coyotos-Repository-3.2-2.fc6.noarch.rpm'
</pre>
      <p>
	You can then install the cross compilation
	tools by running:
      </p>
      <pre>
su -c 'yum install capros-i386-xenv'
</pre>
      <p>
	And you can then update the cross compilation
	tools by running:
      </p>
      <pre>
su -c 'yum update capros-i386-xenv'
</pre>
      <p>
        (If the above fails, see 
        <a href="http://sourceforge.net/mailarchive/message.php?msg_name=1147834740.31996.95.camel%40mikado64.cs.jhu.edu">
email of 5/16/06</a>.)
      </p>
      <p>
	The <tt>capros-i386-xenv</tt> package is a
	"virtual" package - it simply supplies the necessary
	dependencies so that YUM will find all of the pieces you need.
        All of the CapROS cross environment tools install into
	the top-level directory <tt>/capros/</tt>.
      </p>
      <p>
        For more information, 
        refer to the 
        <a href="http://www.coyotos.org/docs/build/build.html#1.3">
        Coyotos build instructions</a>, substituting "capros" where
        appropriate.
      </p>
      <h3>2.2.2 Setting up on Fedora core 8 using the GUI</h3>
	  <p>
	    If you are running of Fedora Core 8, you can add the build tools
	    to your automatic software update list with the following procedure.
	  </p>
	  <p>
	    Under "Applications", open the "Add/Remove Software" and enter your
	    root password when prompted.
	  </p>
	  <p>
	    Open up the "Edit" menu and select "Repositories".
	  </p>
	  Click the "Add" button to add the Coyotos repository
	  </p>
	  <p>
	    Fill in the fields:
	  </p>
	  <pre>
Name:         Coyotos RPMs
Description:  Development tools for Coyotos/CapROS
Location:     http://www.coyotos.org/YUM/coyotos/6/i386/
	  </pre>
	  <p>
	    and click "OK".
	  </p>
	  <p>
	    Close the Repository Manager.
	  </p>
	  <p>
	    Select the "Search" tab, and enter "Coyotos-Repository" in
	    the search.
	    When the search completes, check the check box for:
	  </p>
	  <pre>
Coyotos-Repository-3.2-2.fc6.noarch
	  </pre>
	  <p>
	    Click "Apply".  Click "Continue" on the popup.
	  </p>
	  <p>
	    Select the "Search" tab, and enter "capros-i386-xenv" in the search.
	    When the search completes, check the check box for:
	  </p>
	  <pre>
capros-i386-xenv - 0.1.6.4fc6.i386
	  </pre>
	  <p>
	    Click "Apply".  Click "Continue" on the popup.
      </p>
      <h3>2.2.3 Setting up on Other UNIX's</h3>
      <p>
	If you are building on some other UNIX
	derivative that does not support YUM, you may find
	that nothing will do but to build the cross environment for
	yourself. 
        For instructions, go to the
        <a href="http://www.coyotos.org/docs/build/build.html#1.4">
        Coyotos build instructions</a> for guidance.
        You may need to set COYOTOS_XENV to /capros/host and substitute
        "capros" where appropriate elsewhere. 
	  </p>
	  <h2>2.3. Building CapROS</h2>
	  <p>
            Follow the instructions on SourceForge for accessing 
            and downloading the CapROS CVS repository.
            The projectname is capros, and the module name is eros
            (we haven't yet changed the name of the module).
            After setting CVSROOT appropriately, use the command
	  <ul>
<pre>
cvs checkout -P eros
</pre>
	  </ul>
	  </p>
	  <p>
            At the moment there is no tarball for the CapROS sources.
            We will add this when the system becomes stable enough
            for non-developers. 
	  </p>
	  <p>
	    Now you can build CapROS by
	  </p>
	  <ul>
<pre>
cd somewhere/eros/src
make
</pre>
	  </ul>
          <p>
          Some make targets that may be useful:
          </p>
          <ul>
          <li>clean - remove all generated files
          <li>distclean - clean, and also remove install directories under eros/
          </ul>
	  <h2>2.4. Running a test program</h2>
	  <p>
            To run CapROS, you must have a boot partition with a file system 
            where GRUB will find the files to load.
            Define CAPROS_BOOT_PARTITION as the name of this partition.
            For example:
	  </p>
<pre>
export CAPROS_BOOT_PARTITION=/boot
</pre>
	  <p> 
            To run the persistent version (not yet implemented),
            you must also have a hard disk partition formatted for CapROS. 
	    Use your handy
	    <tt>fdisk</tt> equivalent to create a partition, and give it
	    type 0x95.
            Define the shell variable EROS_HD as the device name
            for this partition. For example:
	  </p>
<pre>
export EROS_HD=/dev/hda1
</pre>
	  <p>
            Before using the CapROS partition for the first time,
            you must format it:
	  </p>
	  <ul>
<pre>
cd somewhere/eros/src/tutorials/hello-large
make init.hd
</pre>
	  </ul>
	  <p>
            Then to compile and load the test program into the CapROS
            system:
	  </p>
	  <ul>
<pre>
cd somewhere/eros/src/tutorials/hello-large
make np
</pre>
	  </ul>
	  <p>
            To run the test program, boot the computer, and type the
            following commands to GRUB:
	  </p>
<pre>
root (hd0,1)     # or the appropriate value for your boot partition
kernel --type=multiboot /CapROS-kernimg
</pre>
	  <p>
            You may wish to add an item to your GRUB menu.lst file
            with these commands. 
	  </p>
	  <h1>3. Run-Time Requirements</h1>
	  <p>
	    CapROS has been tested on a Pentium II, a Mobile AMD Athlon,
            and Vmware. 
            The following notes give an idea of what we expect
            will be needed.
	  </p>
	  <h2>3.1 Disk Space</h2>
	  <p>
	    CapROS <em>can</em> run in as little as 20
	    Mbytes.  Doing anything interesting with it will certainly
	    require more.  At the moment we are suggesting a 100 Mbyte
	    partition if you just want to fiddle with it, or a 250
	    Mbyte partition if you have something more serious in
	    mind.
	  </p>
	  To boot from the hard disk, the CapROS partition
	  must fall within the bootable range of your machine.  It is
	  also possible (even straightforward) to boot CapROS from a
	  floppy, which allows non-bootable partitions to be used.
	  The kernel theoretically groks extended partitions, but we
	  have never tested this.
	</p>
	  <h2>3.2 Hardware</h2>
	  <p>
	    CapROS will support the following hardware (all
	    trademarks belong to their respective owners):
	  </p>
	  <table>
	    <tr valign="top">
	      <td><strong>Processor</strong></td>
	      <td>486, Pentium, Pentium Pro.  There's nothing we're aware of
		that would prevent clone processors from working, but we have
		no way to test them and they are not a priority for us. If you
		have them, we would be glad to hear what luck you have.  Up to
		a point, we'll try to help get them working.
		<p> CapROS runs on all of the multiprocessor boards we have
		  tried, but the first research release will not provide SMP
		  support.
	      </td>
	    </tr>
	    <tr valign="top">
	      <td><strong>BIOS</strong></td>
	      <td>We are not aware of any BIOS-specific dependencies. We have
		not tested large drives on BIOS's that do not support extended
		drive size information.
	      </td>
	    </tr>
	    <tr valign="top">
	      <td><strong>Motherboard</strong></td>
	      <td>We are not aware of specific dependencies.  We use the TYAN
		family of motherboards, but have also run successfully on a
		number of clone boards.
	      </td>
	    </tr>
	    <tr valign="top">
	      <td><strong>Memory</strong></td>
	      <td>We have run CapROS successfully (albeit unintentionally) on a
		machine with only 640K of memory.  This is not a recommended
		configuration.  8M should be fine for now, but 16M is better.
	      </td>
	    </tr>
	    <tr valign="top">
	      <td><strong>Disk</strong></td>
	      <td>The first research release will <em>not</em> support SCSI
		disks.  There are a great many SCSI controllers, and we have
		found that the <em>sustainable</em> throughput for IDE is as
		good or better than we see from SCSI.  We are aware that many
		people want to run SCSI devices.  
		<p> When we do get to SCSI (which should be soon -- it's
		  necessary for the MIPS port we are doing), our first attention
		  will go to the Adaptec 2940 family, because that is what we
		  have.  Support for other adaptors will be guided by demand and
		  availability.  Your chances of getting us to support a card
		  are greatly improved if you have one to loan us.
	      </td>
	    </tr>
	    <tr valign="top">
	      <td><strong>Video</strong></td>
	      <td> The kernel assumes a VGA or better adaptor, but the system
		does not (yet) provide a bitmapped graphics interface.
		<p> We hope to change this in the near future, but are still
		  debating the proper graphics model for this class of system.
		  The Mach32, Mach64, and Diamond cards are high on our priority
		  list.  Our group favors the Toshiba portables, so we'll
		  probably get the C&amp;T chipset family working early as well.
	      </td>
	    </tr>
	    <tr valign="top">
	      <td><strong>Network</strong></td> <td> The current
		implementation includes drivers for the 3COM 3c509 and 3c590XL
		network cards.  Regrettably, these drivers have been well hacked 
		over, so it is not clear that the current implementations actually work.
	      </td>
	    </tr>
	  </table>
	  <h1><a name="ARMBuild">4. Building for ARM</a></h1>
	  <p>
          CapROS can run on the ARMv4 architecture.
          First, get the ARM cross-tools:
          </p>
<pre>
su -c 'yum install capros-arm-xenv'
</pre>
          <p>
          To build for ARM, you need to:
	  </p>
<pre>
export EROS_TARGET=arm
</pre>
	  <p>
          The system has been tested on a Cirrus EDB9315 development board,
          which uses the Cirrus EP9315,
          which is based on the ARM920T microprocessor.
          </p><p>
          To run on the EDB9315:
          <ol><li>
          Build the system for ARM.
          </li><li>
          Go to the directory containing the test case you want to run,
          for example src/base/tests/perf/nc.
          The kernel text, kernel data, and initial system state are loaded
          into the system's memory
          from three separate files in /tftpboot
          (kerneltext, kerneldata, and imgdata respectively).
          Build them:
<pre>
make np
</pre>
          </li><li>
          Set up Redboot according to the instructions that came with
          the EDB9315. To install tftp, you will need to:
<pre>
su -c 'yum install tftp tftp-server'
</pre>
          and then use the application at System->Administration->Services
          to enable tftp and restart xinetd. 
          I also had to enable UDP port 69 in my firewall, and change the
          SELinux setting to Permissive. 
          </li><li>
          Boot the EDB9315 to execute Redboot. 
          Give Redboot the commands:
<pre>
load -v -r -b 0x00300000 imgdata
load -v -r -b 0x00100000 kerneldata
load -v -r -b 0x00200000 kerneltext
go
</pre>
          kerneltext is loaded last because that sets the default start
          address for the go command.
          Consider using Redboot aliases for these commands.
          </li></ol>
	  </p>
<table>
<tr valign=top>
  <td>
<a href="http://sourceforge.net"><img src="http://sourceforge.net/sflogo.php?group_id=132228&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo" /></a>
  </td>
  <td>
      <em>Copyright 2005, 2006, 2007, 2008 by Strawberry Development Group.  All rights reserved.
      For terms of redistribution, see the <a
      href="../legal/license/GPL.html">GNU General Public License</a></em>
This material is based upon work supported by the US Defense Advanced
Research Projects Agency under Contract No. W31P4Q-07-C-0070.
Approved for public release, distribution unlimited.
   </td>
</tr>
</table>
  </BODY>
</HTML>
