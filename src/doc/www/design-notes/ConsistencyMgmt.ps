%!PS-Adobe-2.0
%%Creator: dvips(k) 5.85 Copyright 1999 Radical Eye Software
%%Title: ConsistMgmt.dvi
%%Pages: 11
%%PageOrder: Ascend
%%BoundingBox: 0 0 612 792
%%DocumentFonts: Times-Roman Times-Italic Times-Bold Courier
%%EndComments
%DVIPSWebPage: (www.radicaleye.com)
%DVIPSCommandLine: dvips -o ConsistMgmt.ps ConsistMgmt.dvi
%DVIPSParameters: dpi=600, compressed
%DVIPSSource:  TeX output 1999.10.13:2121
%%BeginProcSet: texc.pro
%!
/TeXDict 300 dict def TeXDict begin/N{def}def/B{bind def}N/S{exch}N/X{S
N}B/A{dup}B/TR{translate}N/isls false N/vsize 11 72 mul N/hsize 8.5 72
mul N/landplus90{false}def/@rigin{isls{[0 landplus90{1 -1}{-1 1}ifelse 0
0 0]concat}if 72 Resolution div 72 VResolution div neg scale isls{
landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div hsize
mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul TR[
matrix currentmatrix{A A round sub abs 0.00001 lt{round}if}forall round
exch round exch]setmatrix}N/@landscape{/isls true N}B/@manualfeed{
statusdict/manualfeed true put}B/@copies{/#copies X}B/FMat[1 0 0 -1 0 0]
N/FBB[0 0 0 0]N/nn 0 N/IEn 0 N/ctr 0 N/df-tail{/nn 8 dict N nn begin
/FontType 3 N/FontMatrix fntrx N/FontBBox FBB N string/base X array
/BitMaps X/BuildChar{CharBuilder}N/Encoding IEn N end A{/foo setfont}2
array copy cvx N load 0 nn put/ctr 0 N[}B/sf 0 N/df{/sf 1 N/fntrx FMat N
df-tail}B/dfs{div/sf X/fntrx[sf 0 0 sf neg 0 0]N df-tail}B/E{pop nn A
definefont setfont}B/Cw{Cd A length 5 sub get}B/Ch{Cd A length 4 sub get
}B/Cx{128 Cd A length 3 sub get sub}B/Cy{Cd A length 2 sub get 127 sub}
B/Cdx{Cd A length 1 sub get}B/Ci{Cd A type/stringtype ne{ctr get/ctr ctr
1 add N}if}B/id 0 N/rw 0 N/rc 0 N/gp 0 N/cp 0 N/G 0 N/CharBuilder{save 3
1 roll S A/base get 2 index get S/BitMaps get S get/Cd X pop/ctr 0 N Cdx
0 Cx Cy Ch sub Cx Cw add Cy setcachedevice Cw Ch true[1 0 0 -1 -.1 Cx
sub Cy .1 sub]/id Ci N/rw Cw 7 add 8 idiv string N/rc 0 N/gp 0 N/cp 0 N{
rc 0 ne{rc 1 sub/rc X rw}{G}ifelse}imagemask restore}B/G{{id gp get/gp
gp 1 add N A 18 mod S 18 idiv pl S get exec}loop}B/adv{cp add/cp X}B
/chg{rw cp id gp 4 index getinterval putinterval A gp add/gp X adv}B/nd{
/cp 0 N rw exit}B/lsh{rw cp 2 copy get A 0 eq{pop 1}{A 255 eq{pop 254}{
A A add 255 and S 1 and or}ifelse}ifelse put 1 adv}B/rsh{rw cp 2 copy
get A 0 eq{pop 128}{A 255 eq{pop 127}{A 2 idiv S 128 and or}ifelse}
ifelse put 1 adv}B/clr{rw cp 2 index string putinterval adv}B/set{rw cp
fillstr 0 4 index getinterval putinterval adv}B/fillstr 18 string 0 1 17
{2 copy 255 put pop}for N/pl[{adv 1 chg}{adv 1 chg nd}{1 add chg}{1 add
chg nd}{adv lsh}{adv lsh nd}{adv rsh}{adv rsh nd}{1 add adv}{/rc X nd}{
1 add set}{1 add clr}{adv 2 chg}{adv 2 chg nd}{pop nd}]A{bind pop}
forall N/D{/cc X A type/stringtype ne{]}if nn/base get cc ctr put nn
/BitMaps get S ctr S sf 1 ne{A A length 1 sub A 2 index S get sf div put
}if put/ctr ctr 1 add N}B/I{cc 1 add D}B/bop{userdict/bop-hook known{
bop-hook}if/SI save N @rigin 0 0 moveto/V matrix currentmatrix A 1 get A
mul exch 0 get A mul add .99 lt{/QV}{/RV}ifelse load def pop pop}N/eop{
SI restore userdict/eop-hook known{eop-hook}if showpage}N/@start{
userdict/start-hook known{start-hook}if pop/VResolution X/Resolution X
1000 div/DVImag X/IEn 256 array N 2 string 0 1 255{IEn S A 360 add 36 4
index cvrs cvn put}for pop 65781.76 div/vsize X 65781.76 div/hsize X}N
/p{show}N/RMat[1 0 0 -1 0 0]N/BDot 260 string N/Rx 0 N/Ry 0 N/V{}B/RV/v{
/Ry X/Rx X V}B statusdict begin/product where{pop false[(Display)(NeXT)
(LaserWriter 16/600)]{A length product length le{A length product exch 0
exch getinterval eq{pop true exit}if}{pop}ifelse}forall}{false}ifelse
end{{gsave TR -.1 .1 TR 1 1 scale Rx Ry false RMat{BDot}imagemask
grestore}}{{gsave TR -.1 .1 TR Rx Ry scale 1 1 false RMat{BDot}
imagemask grestore}}ifelse B/QV{gsave newpath transform round exch round
exch itransform moveto Rx 0 rlineto 0 Ry neg rlineto Rx neg 0 rlineto
fill grestore}B/a{moveto}B/delta 0 N/tail{A/delta X 0 rmoveto}B/M{S p
delta add tail}B/b{S p tail}B/c{-4 M}B/d{-3 M}B/e{-2 M}B/f{-1 M}B/g{0 M}
B/h{1 M}B/i{2 M}B/j{3 M}B/k{4 M}B/w{0 rmoveto}B/l{p -4 w}B/m{p -3 w}B/n{
p -2 w}B/o{p -1 w}B/q{p 1 w}B/r{p 2 w}B/s{p 3 w}B/t{p 4 w}B/x{0 S
rmoveto}B/y{3 2 roll p a}B/bos{/SS save N}B/eos{SS restore}B end

%%EndProcSet
%%BeginProcSet: 8r.enc
% @@psencodingfile@{
%   author = "S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry",
%   version = "0.6",
%   date = "1 July 1998",
%   filename = "8r.enc",
%   email = "tex-fonts@@tug.org",
%   docstring = "Encoding for TrueType or Type 1 fonts
%                to be used with TeX."
% @}
% 
% Idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard Encoding + ISO Latin 1 + extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% 
% (4) Remaining positions left undefined are for use in (hopefully)
% upward-compatible revisions, if someday more characters are generally
% available.
% 
% (5) hyphen appears twice for compatibility with both 
% ASCII and Windows.
% 
/TeXBase1Encoding [
% 0x00 (encoded characters from Adobe Standard not in Windows 3.1)
  /.notdef /dotaccent /fi /fl
  /fraction /hungarumlaut /Lslash /lslash
  /ogonek /ring /.notdef
  /breve /minus /.notdef 
% These are the only two remaining unencoded characters, so may as
% well include them.
  /Zcaron /zcaron 
% 0x10
 /caron /dotlessi 
% (unusual TeX characters available in, e.g., Lucida Bright)
 /dotlessj /ff /ffi /ffl 
 /.notdef /.notdef /.notdef /.notdef
 /.notdef /.notdef /.notdef /.notdef
 % very contentious; it's so painful not having quoteleft and quoteright
 % at 96 and 145 that we move the things normally found there to here.
 /grave /quotesingle 
% 0x20 (ASCII begins)
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three /four /five /six /seven
 /eight /nine /colon /semicolon /less /equal /greater /question
% 0x40
 /at /A /B /C /D /E /F /G /H /I /J /K /L /M /N /O
% 0x50
 /P /Q /R /S /T /U /V /W
 /X /Y /Z /bracketleft /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o
% 0x70
 /p /q /r /s /t /u /v /w
 /x /y /z /braceleft /bar /braceright /asciitilde
 /.notdef % rubout; ASCII ends
% 0x80
 /.notdef /.notdef /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /.notdef /.notdef /.notdef
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /.notdef /.notdef /Ydieresis
% 0xA0
 /.notdef % nobreakspace
 /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot
 /hyphen % Y&Y (also at 45); Windows' softhyphen
 /registered
 /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def

%%EndProcSet
%%BeginProcSet: texps.pro
%!
TeXDict begin/rf{findfont dup length 1 add dict begin{1 index/FID ne 2
index/UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]/Metrics
exch def dict begin Encoding{exch dup type/integertype ne{pop pop 1 sub
dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get div def}
ifelse}forall Metrics/Metrics currentdict end def[2 index currentdict
end definefont 3 -1 roll makefont/setfont cvx]cvx def}def/ObliqueSlant{
dup sin S cos div neg}B/SlantFont{4 index mul add}def/ExtendFont{3 -1
roll mul exch}def/ReEncodeFont{CharStrings rcheck{/Encoding false def
dup[exch{dup CharStrings exch known not{pop/.notdef/Encoding true def}
if}forall Encoding{]exch pop}{cleartomark}ifelse}if/Encoding exch def}
def end

%%EndProcSet
%%BeginProcSet: special.pro
%!
TeXDict begin/SDict 200 dict N SDict begin/@SpecialDefaults{/hs 612 N
/vs 792 N/ho 0 N/vo 0 N/hsc 1 N/vsc 1 N/ang 0 N/CLIP 0 N/rwiSeen false N
/rhiSeen false N/letter{}N/note{}N/a4{}N/legal{}N}B/@scaleunit 100 N
/@hscale{@scaleunit div/hsc X}B/@vscale{@scaleunit div/vsc X}B/@hsize{
/hs X/CLIP 1 N}B/@vsize{/vs X/CLIP 1 N}B/@clip{/CLIP 2 N}B/@hoffset{/ho
X}B/@voffset{/vo X}B/@angle{/ang X}B/@rwi{10 div/rwi X/rwiSeen true N}B
/@rhi{10 div/rhi X/rhiSeen true N}B/@llx{/llx X}B/@lly{/lly X}B/@urx{
/urx X}B/@ury{/ury X}B/magscale true def end/@MacSetUp{userdict/md known
{userdict/md get type/dicttype eq{userdict begin md length 10 add md
maxlength ge{/md md dup length 20 add dict copy def}if end md begin
/letter{}N/note{}N/legal{}N/od{txpose 1 0 mtx defaultmatrix dtransform S
atan/pa X newpath clippath mark{transform{itransform moveto}}{transform{
itransform lineto}}{6 -2 roll transform 6 -2 roll transform 6 -2 roll
transform{itransform 6 2 roll itransform 6 2 roll itransform 6 2 roll
curveto}}{{closepath}}pathforall newpath counttomark array astore/gc xdf
pop ct 39 0 put 10 fz 0 fs 2 F/|______Courier fnt invertflag{PaintBlack}
if}N/txpose{pxs pys scale ppr aload pop por{noflips{pop S neg S TR pop 1
-1 scale}if xflip yflip and{pop S neg S TR 180 rotate 1 -1 scale ppr 3
get ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg TR}if xflip
yflip not and{pop S neg S TR pop 180 rotate ppr 3 get ppr 1 get neg sub
neg 0 TR}if yflip xflip not and{ppr 1 get neg ppr 0 get neg TR}if}{
noflips{TR pop pop 270 rotate 1 -1 scale}if xflip yflip and{TR pop pop
90 rotate 1 -1 scale ppr 3 get ppr 1 get neg sub neg ppr 2 get ppr 0 get
neg sub neg TR}if xflip yflip not and{TR pop pop 90 rotate ppr 3 get ppr
1 get neg sub neg 0 TR}if yflip xflip not and{TR pop pop 270 rotate ppr
2 get ppr 0 get neg sub neg 0 S TR}if}ifelse scaleby96{ppr aload pop 4
-1 roll add 2 div 3 1 roll add 2 div 2 copy TR .96 dup scale neg S neg S
TR}if}N/cp{pop pop showpage pm restore}N end}if}if}N/normalscale{
Resolution 72 div VResolution 72 div neg scale magscale{DVImag dup scale
}if 0 setgray}N/psfts{S 65781.76 div N}N/startTexFig{/psf$SavedState
save N userdict maxlength dict begin/magscale true def normalscale
currentpoint TR/psf$ury psfts/psf$urx psfts/psf$lly psfts/psf$llx psfts
/psf$y psfts/psf$x psfts currentpoint/psf$cy X/psf$cx X/psf$sx psf$x
psf$urx psf$llx sub div N/psf$sy psf$y psf$ury psf$lly sub div N psf$sx
psf$sy scale psf$cx psf$sx div psf$llx sub psf$cy psf$sy div psf$ury sub
TR/showpage{}N/erasepage{}N/copypage{}N/p 3 def @MacSetUp}N/doclip{
psf$llx psf$lly psf$urx psf$ury currentpoint 6 2 roll newpath 4 copy 4 2
roll moveto 6 -1 roll S lineto S lineto S lineto closepath clip newpath
moveto}N/endTexFig{end psf$SavedState restore}N/@beginspecial{SDict
begin/SpecialSave save N gsave normalscale currentpoint TR
@SpecialDefaults count/ocount X/dcount countdictstack N}N/@setspecial{
CLIP 1 eq{newpath 0 0 moveto hs 0 rlineto 0 vs rlineto hs neg 0 rlineto
closepath clip}if ho vo TR hsc vsc scale ang rotate rwiSeen{rwi urx llx
sub div rhiSeen{rhi ury lly sub div}{dup}ifelse scale llx neg lly neg TR
}{rhiSeen{rhi ury lly sub div dup scale llx neg lly neg TR}if}ifelse
CLIP 2 eq{newpath llx lly moveto urx lly lineto urx ury lineto llx ury
lineto closepath clip}if/showpage{}N/erasepage{}N/copypage{}N newpath}N
/@endspecial{count ocount sub{pop}repeat countdictstack dcount sub{end}
repeat grestore SpecialSave restore end}N/@defspecial{SDict begin}N
/@fedspecial{end}B/li{lineto}B/rl{rlineto}B/rc{rcurveto}B/np{/SaveX
currentpoint/SaveY X N 1 setlinecap newpath}N/st{stroke SaveX SaveY
moveto}N/fil{fill SaveX SaveY moveto}N/ellipse{/endangle X/startangle X
/yrad X/xrad X/savematrix matrix currentmatrix N TR xrad yrad scale 0 0
1 startangle endangle arc savematrix setmatrix}N end

%%EndProcSet
TeXDict begin 40258431 52099146 1000 600 600 (ConsistMgmt.dvi)
@start
%DVIPSBitmapFont: Fa cmsy10 10 1
/Fa 1 16 df<EB1FF0EB7FFC48B5FC4814804814C04814E04814F04814F8A24814FCA2B6
12FEA96C14FCA26C14F8A26C14F06C14E06C14C06C14806C140038007FFCEB1FF01F1F7B
A42A>15 D E
%EndDVIPSBitmapFont
/Fb 103[50 26[50 1[50 1[50 50 50 50 50 50 50 50 1[50
50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 1[50 1[50
1[50 2[50 50 1[50 50 50 2[50 50 1[50 50 50 1[50 50 50
50 50 50 50 50 50 2[50 50 50 50 50 5[50 50 1[50 50 50
50 50 50 50 50 50 50 1[50 38[{TeXBase1Encoding ReEncodeFont}67
83.022 /Courier rf
%DVIPSBitmapFont: Fc cmr6 6 3
/Fc 3 54 df<13E01201120712FF12F91201B3A7487EB512C0A212217AA01E>49
D<13FF000313C0380F03E0381C00F014F8003E13FC147CA2001E13FC120CC712F8A2EB01
F0EB03E0EB0FC03801FF00A2380003E0EB00F01478147C143E143F1230127812FCA2143E
48137E0060137C003813F8381E03F0380FFFC00001130018227DA01E>51
D<00101330381E01F0381FFFE014C01480EBFE00EA1BF00018C7FCA513FE381BFF80381F
03C0381C01E0381800F014F8C71278A2147CA21230127812F8A214784813F8006013F038
7001E01238381E07803807FF00EA01F816227CA01E>53 D E
%EndDVIPSBitmapFont
%DVIPSBitmapFont: Fd cmr8 8 1
/Fd 1 51 df<EB7F803801FFF0380780FC380E003F48EB1F8048EB0FC05A0060EB07E012
F000FC14F07E1403A3007C1307C7FCA215E0140F15C0141F1580EC3F00147E147C5C495A
495A495A495A011EC7FC5B5B4913305B485A4848136048C7FC000E14E0001FB5FC5A4814
C0B6FCA21C2C7DAB23>50 D E
%EndDVIPSBitmapFont
/Fe 201[25 25 25 25 25 25 49[{TeXBase1Encoding ReEncodeFont}6
49.8132 /Times-Roman rf /Ff 201[29 29 29 29 29 29 49[{
TeXBase1Encoding ReEncodeFont}6 58.1154 /Times-Roman
rf /Fg 133[44 50 50 72 50 1[33 39 44 1[55 50 55 83 28
55 33 28 55 50 1[44 55 44 55 50 9[100 72 1[66 55 3[78
1[94 66 78 1[39 78 1[61 1[72 72 1[72 10[50 50 50 50 50
50 2[25 46[{TeXBase1Encoding ReEncodeFont}44 99.6264
/Times-Bold rf /Fh 165[51 60 3[60 51 46 55 1[46 60 60
74 51 60 1[28 60 60 46 51 1[55 55 60 10[42 42 42 42 42
50[{.167 SlantFont TeXBase1Encoding ReEncodeFont}25 83.022
/Times-Roman rf /Fi 133[37 42 42 60 42 46 28 32 37 1[46
42 46 69 23 46 28 23 46 42 28 37 46 37 46 42 9[83 1[60
55 46 60 1[51 65 60 78 55 65 1[32 3[55 60 60 1[60 8[42
42 42 42 42 42 42 42 2[21 28 42[46 2[{TeXBase1Encoding ReEncodeFont}52
83.022 /Times-Bold rf /Fj 107[29 29 24[29 33 33 48 33
33 18 26 22 33 33 33 33 52 18 33 18 18 33 33 22 29 33
29 33 29 9[63 2[41 37 44 1[37 48 48 59 1[48 26 22 48
48 37 41 48 44 44 48 6[18 33 33 33 33 33 33 33 33 33
33 1[17 22 17 2[22 22 22 52 2[33 31[37 37 2[{
TeXBase1Encoding ReEncodeFont}68 66.4176 /Times-Roman
rf
%DVIPSBitmapFont: Fk cmsy6 6 2
/Fk 2 4 df<B712C0A322037A8D30>0 D<136013701360A20040132000E0137038F861F0
387E67E0381FFF803807FE00EA00F0EA07FE381FFF80387E67E038F861F038E060700040
132000001300A21370136014157B9620>3 D E
%EndDVIPSBitmapFont
/Fl 134[37 1[55 37 42 23 32 32 42 42 42 42 60 23 37 23
23 42 42 23 37 42 37 42 42 8[51 69 1[60 46 42 51 1[51
60 55 69 1[55 1[28 3[51 1[55 1[51 12[42 2[42 3[28 21
4[28 36[42 2[{TeXBase1Encoding ReEncodeFont}45 83.022
/Times-Italic rf /Fm 133[53 60 3[66 40 47 53 1[66 60
66 100 33 66 1[33 66 60 40 53 66 53 66 60 12[80 66 86
1[73 93 1[113 80 2[47 3[80 1[86 1[86 10[60 60 60 60 60
60 49[{TeXBase1Encoding ReEncodeFont}38 119.552 /Times-Bold
rf
%DVIPSBitmapFont: Fn cmsy8 8 2
/Fn 2 14 df<130C131EA50060EB01800078130739FC0C0FC0007FEB3F80393F8C7F0038
07CCF83801FFE038007F80011EC7FCEB7F803801FFE03807CCF8383F8C7F397F0C3F8000
FCEB0FC039781E078000601301000090C7FCA5130C1A1D7C9E23>3
D<ED7FF80207B57E021F14E091397FC00FF8D901FCC712FED903F0143FD90FC0EC0FC049
C8EA03E0013E6F7E0178ED0078498248488248488249820007188048CAEA03C0000E1701
001E18E0001C1700003C18F0003818700078187800701838A300F0183C48181CA96C183C
00701838A30078187800381870003C18F0001C18E0001E1701000E18C0000F17036C6CEE
0780000318006D5E6C6C161E6C6C5E01785E013E4B5A6D4B5AD90FC0EC0FC0D903F0023F
C7FCD901FC14FE903A007FC00FF8021FB512E0020714809126007FF8C8FC3E3D7CAE47>
13 D E
%EndDVIPSBitmapFont
/Fo 134[44 2[44 1[28 39 39 2[50 50 1[28 2[28 2[28 44
3[50 11[72 4[61 80[{TeXBase1Encoding ReEncodeFont}14
99.6264 /Times-Italic rf /Fp 134[50 2[50 50 28 1[33 1[50
50 50 78 3[28 50 2[44 50 1[50 44 13[55 5[89 2[39 3[55
1[72 10[50 2[50 1[50 1[50 50 2[25 1[25 44[{
TeXBase1Encoding ReEncodeFont}27 99.6264 /Times-Roman
rf /Fq 138[37 21 29 25 1[37 37 37 58 21 2[21 37 1[25
33 37 33 1[33 12[46 42 50 4[66 3[25 5[50 9[37 2[37 5[37
2[25 45[{TeXBase1Encoding ReEncodeFont}26 74.7198 /Times-Roman
rf /Fr 105[42 1[37 37 24[37 42 42 60 42 42 23 32 28 42
42 42 42 65 23 42 23 23 42 42 28 37 42 37 42 37 3[28
1[28 2[60 78 60 60 51 46 55 1[46 60 60 74 51 60 32 28
60 60 46 51 60 55 55 60 5[23 23 42 42 42 42 42 42 42
42 42 42 23 21 28 21 47 1[28 28 28 35[46 46 2[{
TeXBase1Encoding ReEncodeFont}76 83.022 /Times-Roman
rf /Fs 134[72 4[40 56 48 2[72 72 112 40 2[40 72 72 1[64
1[64 1[64 13[80 96 2[104 1[128 1[104 5[88 1[96 67[{
TeXBase1Encoding ReEncodeFont}21 143.462 /Times-Roman
rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin

%%EndSetup
%%Page: 0 1
0 0 bop 619 357 a Fs(Consistenc)n(y)33 b(Management)g(in)i(the)h(ER)-6
b(OS)34 b(K)l(ernel)683 540 y Fr(Implementing)17 b(Ef)n(\002cient)j
(Orthogonal)e(Persistence)i(in)g(A)h(Pure)f(Capability)g(System)911
722 y Fq(Computer)f(and)h(Information)g(Sciences)f(T)-5
b(echnical)19 b(Report)g(MS-CIS-96-06)1553 963 y Fp(Jonathan)24
b(S.)h(Shapiro)1643 1079 y(Da)n(vid)g(J.)f(F)o(arber)1572
1196 y(Jonathan)g(M.)h(Smith)1402 1312 y Fo(Univer)o(sity)f(of)h(P)-8
b(ennsylvania)2498 1276 y Fn(\003)1587 1506 y Fp(24)24
b(February)-6 b(,)25 b(1996)0 1818 y Fm(Abstract)0 2037
y Fr(ER)m(OS)31 b(is)h(a)f(persistent)g(operating)d(system)j(tar)o
(geted)f(to)n(w)o(ards)0 2136 y(managing)15 b(resources)h(with)h(great)
f(longe)n(vity)-5 b(.)22 b(The)16 b(system)h(pro-)0 2236
y(vides)i(a)g(persistent)g(single-le)n(v)o(el)f(store)h(supporting)e
(tw)o(o)i(funda-)0 2336 y(mental)e(object)f(types:)24
b Fl(nodes)16 b Fr(and)h Fl(pa)o(g)o(es)p Fr(.)24 b(All)17
b(primary)f(object-)0 2435 y(s,)36 b(including)30 b(memory)g(se)o
(gments)i(and)f(protection)f(domains,)0 2535 y(are)24
b(constructed)e(out)h(of)h(these)g(fundamental)d(objects,)j(and)f(in-)0
2635 y(herit)e(their)h(persistence.)28 b(ER)m(OS)22 b(is)h(a)f(pure)e
(capability)h(system;)0 2734 y(access)d(to)g(objects)f(is)h(pro)o
(vided)d(e)o(xclusi)n(v)o(ely)h(through)f(the)i(in)m(v)n(o-)0
2834 y(cation)j(of)g(k)o(ernel-enforced,)c(secure)k(capabilities.)0
2967 y(This)38 b(paper)e(describes)h(the)g(ER)m(OS)h(Abstract)f
(Machine)g(and)0 3066 y(the)45 b(mechanisms)f(used)h(to)g(achie)n(v)o
(e)f(ef)n(\002cient)g(consistenc)o(y)0 3166 y(management)38
b(within)i(the)g(system.)85 b(The)40 b(implementation,)0
3266 y(including)h(all)j(primary)d(objects,)48 b(a)c(lo)n(w)f(o)o(v)o
(erhead)d(check-)0 3365 y(point/migration)27 b(subsystem,)32
b(and)e(an)g(ef)n(\002cient)f(interprocess)0 3465 y(communication)20
b(mechanism,)i(requires)f(less)j(than)e(64)g(Kbytes)0
3564 y(of)e(supervisor)f(code)g(\(prior)g(to)h(size)h(tuning\).)p
0 4779 764 4 v 84 4833 a Fk(\003)120 4856 y Fj(This)e(w)o(ork)i(w)o(as)
g(supported)g(by)g(the)g(He)n(wlett-P)o(ackard)j(Research)e(Grants)0
4935 y(Program,)d(the)g(A)-7 b(T&T)17 b(F)o(oundation,)j(CNRI)f(as)f
(manager)i(for)f(NSF)e(and)i(ARP)-6 b(A)0 5014 y(under)30
b(cooperati)n(v)o(e)j(agreement)e(#NCR-8919038,)j(NSF)28
b(#CD)m(A-92-14924,)0 5093 y(and)18 b(ARP)-6 b(A)16 b(#MD)m
(A972-95-1-0013.)0 5251 y(Cop)o(yright)323 5249 y(c)303
5251 y Fn(\015)o Fj(1996,)39 b(Jonathan)e(S.)c(Shapiro.)75
b(Permission)35 b(is)f(granted)j(to)0 5329 y(redistrib)o(ute)19
b(this)d(document)i(in)e(electronic)k(or)c(paper)h(form,)f(pro)o(vided)
h(that)h(this)0 5408 y(cop)o(yright)i(notice)e(is)f(retained.)1992
1818 y Fm(Contents)1992 2037 y Fi(1)82 b(Intr)o(oduction)1290
b(1)1992 2253 y(2)82 b(The)21 b(P)n(ersistence)g(Lay)o(er)955
b(1)2116 2385 y Fr(2.1)86 b(The)20 b(Object)g(Cache)39
b(.)j(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)144
b(2)2116 2518 y(2.2)86 b(Object)20 b(V)-9 b(ersions)48
b(.)41 b(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)144
b(2)2116 2651 y(2.3)86 b(Ageing)19 b(and)h(Sca)n(v)o(enging)33
b(.)41 b(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)144 b(3)1992
2867 y Fi(3)82 b(The)21 b(ER)n(OS)g(Abstract)e(Machine)700
b(3)2116 3000 y Fr(3.1)86 b(Domains)27 b(.)41 b(.)g(.)h(.)f(.)g(.)h(.)f
(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)144 b(3)2116
3133 y(3.2)86 b(Se)o(gments)67 b(.)41 b(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h
(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)144 b(4)2116 3266 y(3.3)86
b(Threads)59 b(.)41 b(.)g(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g
(.)h(.)f(.)g(.)g(.)144 b(5)2116 3398 y(3.4)86 b(In)m(v)n(ocation)18
b(and)h(Messages)54 b(.)42 b(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)144
b(5)1992 3614 y Fi(4)82 b(Realizing)20 b(the)g(Machine)949
b(5)2116 3747 y Fr(4.1)86 b(K)n(e)o(y)20 b(Slot)g(Hazards)56
b(.)42 b(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)144
b(5)2116 3880 y(4.2)86 b(The)20 b(Conte)o(xt)f(Cache)62
b(.)41 b(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)144
b(6)2116 4013 y(4.3)86 b(Mapping)19 b(T)-7 b(able)20
b(Management)53 b(.)41 b(.)g(.)h(.)f(.)g(.)g(.)144 b(6)1992
4229 y Fi(5)82 b(The)21 b(Checkpoint)f(Mechanism)742
b(7)2116 4361 y Fr(5.1)86 b(Freezing)19 b(the)h(Image)60
b(.)41 b(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)144
b(7)2116 4494 y(5.2)86 b(Writing)20 b(the)g(Dirty)g(Objects)37
b(.)42 b(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)144 b(8)2116 4627
y(5.3)86 b(Migration)56 b(.)41 b(.)h(.)f(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)
g(.)g(.)h(.)f(.)g(.)g(.)144 b(8)1992 4843 y Fi(6)82 b(Conclusions)1313
b(8)2116 4976 y Fr(6.1)86 b(Lessons)20 b(Learned)77 b(.)42
b(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)h(.)f(.)g(.)g(.)144 b(8)2116
5109 y(6.2)86 b(Ackno)n(wledgements)41 b(.)g(.)g(.)g(.)h(.)f(.)g(.)g(.)
h(.)f(.)g(.)g(.)144 b(9)p eop
%%Page: 1 2
1 1 bop 0 -199 a Fh(2)83 b(THE)20 b(PERSISTENCE)g(LA)-9
b(YER)2723 b Fr(1)0 91 y Fm(1)119 b(Intr)n(oduction)0
310 y Fr(ER)m(OS,)36 b(the)f(Extremely)f(Reliable)h(Operating)f
(System,)39 b(pro-)0 410 y(vides)34 b(an)g(en)m(vironment)d(for)i(the)h
(construction)e(of)i(persistent)0 509 y(application)15
b(systems.)24 b(The)16 b(moti)n(v)n(ation)f(for)h(this)h(ef)n(fort)e
(is)j(to)e(f)o(a-)0 609 y(cilitate)j(research)f(in)h(user)f(en)m
(vironments,)e(reliable)j(application)0 709 y(design,)24
b(scheduling,)f(security)-5 b(,)24 b(and)g(reco)o(v)o(erable)d(distrib)
n(ution)0 808 y(in)i(such)f(systems.)34 b(ER)m(OS)23
b(may)f(be)h(vie)n(wed)f(as)h(a)h(single)e(lar)o(ge-)0
908 y(scale)j(persistent)g(application)e(that)i(serv)o(es)g(multiple)f
(mutually)0 1007 y(suspicious)18 b(users.)25 b(A)19 b(primary)e(design)
h(objecti)n(v)o(e)g(is)h(to)g(achie)n(v)o(e)0 1107 y(a)g(softw)o(are)f
(mean)h(time)f(between)g(f)o(ailures)h(\(MTBF\))f(measured)0
1207 y(in)k(years.)29 b(This)22 b(is)g(achie)n(v)o(ed)e(through)g(a)i
(combination)d(of)j(care-)0 1306 y(ful)c(object)g(design,)f
(enforcement)f(of)i(containment,)e(aggressi)n(v)o(e)0
1406 y(f)o(ault)i(detection,)f(ef)n(fecti)n(v)o(e)f(f)o(ault)i
(isolation,)f(and)g(user)n(-pro)o(vided)0 1506 y(reco)o(v)o(ery)h
(policies.)0 1638 y(ER)m(OS)29 b(is)g(similar)g(to)g(a)f(prior)g
(system,)i(K)n(e)o(yK)n(OS)e([Hardy85)m(],)0 1738 y(de)n(v)o(eloped)34
b(by)i(K)n(e)o(y)g(Logic,)k(Inc.)c(to)h(support)e(reliable)h(time)0
1838 y(sharing)26 b(services)i(among)e(mutually)g(suspicious)h(users.)
46 b(Lik)o(e)0 1937 y(K)n(e)o(yK)n(OS,)39 b(ER)m(OS)i(implements)e
(global)h(orthogonal)d(persis-)0 2037 y(tence)32 b(based)h(on)f(a)h
(simple)f(fundamental)e(object)i(model;)38 b(all)0 2137
y(system)26 b(state,)i(including)c(processes,)j(are)f(checkpointed)d
(on)j(a)0 2236 y(periodic)18 b(basis.)25 b(Also)20 b(lik)o(e)f(K)n(e)o
(yK)n(OS,)g(ER)m(OS)g(is)i(designed)d(as)i(a)0 2336 y(small)e(microk)o
(ernel)d(with)i(a)h(high)e(performance)f(message)i(pass-)0
2435 y(ing)j(subsystem)g([Bomber)o(ger92)-5 b(].)0 2568
y(Unlik)o(e)21 b(K)n(e)o(yK)n(OS,)e(ER)m(OS)j(is)g(designed)d(as)j(a)f
(distrib)n(uted,)f(real-)0 2668 y(time)e(system.)24 b(Threads)17
b(in)h(ER)m(OS)g(are)f(\002rst)i(class)f(objects)g(asso-)0
2768 y(ciated)25 b(with)g(a)g(particular)e(compute)h(resource.)37
b(K)n(e)o(yK)n(OS)24 b(me-)0 2867 y(ters)29 b(ha)n(v)o(e)f(been)g
(abandoned)d(in)k(f)o(a)n(v)n(or)f(of)g(schedule)g(capabili-)0
2967 y(ties,)d(which)f(distrib)n(ute)f(more)g(easily)h(and)f(are)h
(better)f(suited)h(to)0 3066 y(real-time)j(scheduling)f(requirements.)
46 b(ER)m(OS)28 b(implements)f(a)0 3166 y(distrib)n(uted)c(single)h(le)
n(v)o(el)g(store.)36 b(These)24 b(changes)f(ha)n(v)o(e)g(neces-)0
3266 y(sitated)17 b(an)g(entirely)f(ne)n(w)g(implementation)f(that)i
(departs)f(signif-)0 3365 y(icantly)k(from)f(the)h(K)n(e)o(yK)n(OS)f
(system.)0 3498 y(This)i(paper)f(describes)h(the)g(ER)m(OS)h
(persistent)f(system,)g(includ-)0 3598 y(ing)f(all)i(of)e(the)h
(signi\002cant)f(primary)f(objects.)26 b(W)-7 b(e)22
b(describe)e(the)0 3697 y(fundamental)31 b(objects,)k(the)e(abstract)g
(machine)f(crafted)g(from)0 3797 y(those)21 b(objects,)g(and)g(the)g
(mechanisms)f(used)h(to)g(ef)n(\002ciently)g(and)0 3897
y(consistently)31 b(map)g(these)h(abstractions)e(onto)h(the)h
(underlying)0 3996 y(hardw)o(are.)d(In)22 b(addition,)f(we)h(describe)f
(a)i(number)d(of)h(cacheing)0 4096 y(techniques)e(used)h(to)g(f)o
(acilitate)h(ef)n(\002cient)e(e)o(x)o(ecution.)0 4229
y(W)m(ith)e(minor)e(dif)n(ferences)g(in)i(the)f(sizes)i(of)e(a)h(fe)n
(w)g(\002elds,)g(the)g(sys-)0 4328 y(tem)26 b(described)e(here)h(is)h
(currently)e(running.)38 b(While)26 b(untuned,)0 4428
y(the)j(techniques)e(used)h(are)h(similar)f(enough)f(in)i(spirit)f(to)h
(prior)0 4528 y(implementations)24 b(that)i(we)g(are)g(con\002dent)e
(the)o(y)h(will)i(perform)0 4627 y(well)21 b(as)g(the)f(implementation)
e(is)j(re\002ned.)1992 91 y Fm(2)119 b(The)30 b(P)n(ersistence)f(Lay)o
(er)1992 310 y Fr(The)d Fi(primary)h(objects)g Fr(of)g(the)g(ER)m(OS)g
(system)h(are)f Fl(domains)p Fr(,)1992 410 y Fl(se)m(gments)p
Fr(,)e Fl(stall)h(queues)p Fr(,)f Fl(thr)m(eads)p Fr(,)g
Fl(nodes)p Fr(,)h(and)e Fl(pa)o(g)o(es)p Fr(.)39 b(From)1992
509 y(one)26 b(perspecti)n(v)o(e,)h(these)g(object)f(types)h(ha)n(v)o
(e)g(co-equal)e(status.)1992 609 y(Each)d(is)j(persistent,)e(each)g
(has)h(a)g(well)g(de\002ned,)f(k)o(ernel)f(imple-)1992
709 y(mented)h(object)i(protocol,)f(and)g(each)h(can)f(be)h
(manipulated)e(by)1992 808 y(an)o(y)c(holder)g(of)h(an)g(appropriate)e
(capability)-5 b(.)1992 941 y(The)22 b(persistence)g(architecture)f(is)
j(de\002ned)e(in)g(terms)h(of)g(nodes,)1992 1041 y(pages,)g(and)g
(threads.)33 b(Domains,)23 b(stall)i(queues,)e(and)f(se)o(gments)1992
1140 y(are)f(composed)e(from)h(nodes)h(and)g(pages.)27
b(Their)21 b(persistence)g(is)1992 1240 y(a)e(consequence)d(of)j(their)
f(composition)f(from)h(these)g(indi)n(visible)1992 1340
y(units.)34 b(Where)24 b(it)g(is)h(important)c(to)j(distinguish)f
(between)f(these)1992 1439 y(layers,)31 b(this)f(paper)f(refers)g(to)h
(nodes,)h(pages,)g(and)e(threads)g(as)1992 1539 y Fi(fundamental)19
b(objects)p Fr(.)2246 1650 y
 11051335 5591449 0 0 11051335 5591449 startTexFig
 2246 1650 a
%%BeginDocument: ObSystem.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: ObSystem.fig
%%Creator: fig2dev Version 3.2 Patchlevel 1
%%CreationDate: Wed Oct 13 21:20:36 1999
%%For: shapj@bonzo.watson.ibm.com (Jonathan Shapiro)
%%Orientation: Portrait
%%BoundingBox: 0 0 168 85
%%Pages: 0
%%BeginSetup
%%EndSetup
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-18.0 118.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def
%%EndProlog

$F2psBegin
10 setmiterlimit
n -1000 2962 m -1000 -1000 l 4087 -1000 l 4087 2962 l cp clip
 0.06000 0.06000 sc
% Polyline
7.500 slw
n 1305 1425 m 1200 1425 1200 1845 105 arcto 4 {pop} repeat
  1200 1950 2970 1950 105 arcto 4 {pop} repeat
  3075 1950 3075 1530 105 arcto 4 {pop} repeat
  3075 1425 1305 1425 105 arcto 4 {pop} repeat
 cp gs col7 0.95 shd ef gr gs col-1 s gr 
/Times-BoldItalic ff 150.00 scf sf
301 769 m
gs 1 -1 sc (Thread Pool) col-1 sh gr
% Arc
gs  clippath
1317 1168 m 1425 1107 l 1358 1211 l 1457 1119 l 1415 1075 l cp
clip
n 1083.6 854.6 424.6 127.4 36.5 arcn
gs col-1 s gr
 gr

% arrowhead
n 1317 1168 m 1425 1107 l 1358 1211 l 1338 1189 l 1317 1168 l  cp gs 0.00 setgray ef gr  col-1 s
% Arc
gs  clippath
1155 1050 m 1276 1024 l 1181 1104 l 1303 1044 l 1276 990 l cp
clip
n 1013.5 658.9 449.7 125.7 54.3 arcn
gs col-1 s gr
 gr

% arrowhead
n 1155 1050 m 1276 1024 l 1181 1104 l 1168 1077 l 1155 1050 l  cp gs 0.00 setgray ef gr  col-1 s
% Arc
gs  clippath
1234 813 m 1350 855 l 1228 873 l 1362 886 l 1368 827 l cp
clip
n 1238.0 1227.5 389.0 -132.3 -73.3 arc
gs col-1 s gr
 gr

% arrowhead
n 1234 813 m 1350 855 l 1228 873 l 1231 843 l 1234 813 l  cp gs 0.00 setgray ef gr  col-1 s
% Ellipse
n 488 981 53 61 0 360 DrawEllipse gs col-1 s gr

% Ellipse
n 564 1233 53 61 0 360 DrawEllipse gs col-1 s gr

% Ellipse
n 714 979 53 61 0 360 DrawEllipse gs col-1 s gr

% Ellipse
n 787 1235 53 61 0 360 DrawEllipse gs col-1 s gr

% Ellipse
n 938 981 53 61 0 360 DrawEllipse gs col-1 s gr

% Ellipse
n 784 1388 53 61 0 360 DrawEllipse gs col-1 s gr

% Polyline
n 1305 750 m 1200 750 1200 1845 105 arcto 4 {pop} repeat
  1200 1950 2970 1950 105 arcto 4 {pop} repeat
  3075 1950 3075 855 105 arcto 4 {pop} repeat
  3075 750 1305 750 105 arcto 4 {pop} repeat
 cp gs col-1 s gr 
% Polyline
n 375 1613 m 975 1613 l 975 1950 l 375 1950 l cp gs col-1 s gr 
% Polyline
n 510 855 m 375 855 375 1365 135 arcto 4 {pop} repeat
  375 1500 916 1500 135 arcto 4 {pop} repeat
  1051 1500 1051 990 135 arcto 4 {pop} repeat
  1051 855 510 855 135 arcto 4 {pop} repeat
 cp gs col-1 s gr 
/Times-Bold ff 150.00 scf sf
1276 1025 m
gs 1 -1 sc (Domains) col-1 sh gr
/Times-Bold ff 150.00 scf sf
2102 1025 m
gs 1 -1 sc (Segments) col-1 sh gr
/Times-Bold ff 150.00 scf sf
2102 1277 m
gs 1 -1 sc (Stall Queues) col-1 sh gr
/Times-Bold ff 150.00 scf sf
1350 1650 m
gs 1 -1 sc (Nodes) col-1 sh gr
/Times-Bold ff 150.00 scf sf
2250 1650 m
gs 1 -1 sc (Pages) col-1 sh gr
/Times-BoldItalic ff 150.00 scf sf
1650 1875 m
gs 1 -1 sc (Fundamental Objects) col-1 sh gr
/Times-BoldItalic ff 150.00 scf sf
1650 675 m
gs 1 -1 sc (Primary Objects) col-1 sh gr
/Times-Bold ff 150.00 scf sf
450 1800 m
gs 1 -1 sc (Host) col-1 sh gr
$F2psEnd
rs

%%EndDocument

 endTexFig
 2464 2540 a Fr(Figure)g(1:)25 b(The)20 b(Object)g(System)1992
2818 y(A)43 b Fi(page)f Fr(is)h(a)g(repository)e(of)h(user)h(data.)92
b(It)43 b(contains)f(an)1992 2918 y(architecture-de\002ned)19
b(number)h(of)j(bytes.)32 b(A)23 b Fi(node)g Fr(is)g(a)h(repos-)1992
3017 y(itory)29 b(of)h(a)g(\002x)o(ed)f(number)f(of)i(secure)g
(capabilities)f(kno)n(wn)g(as)1992 3117 y Fi(k)o(eys)p
Fr(.)24 b(In)15 b(all)h(current)f(ER)m(OS)h(implementations,)f(nodes)g
(contain)1992 3217 y(16)22 b(k)o(e)o(ys.)33 b(A)23 b
Fi(thr)o(ead)f Fr(is)i(a)f(stateless)i(binding)c(agent)h(between)g(a)
1992 3316 y(domain)h(and)h(a)h(host.)38 b(Threads)23
b(therefore)g(act)i(as)g(the)f(locus)h(of)1992 3416 y(scheduling.)e
(Threads,)c(nodes)g(and)h(pages)g(are)g(persistent.)1992
3549 y(All)55 b(ER)m(OS)h(objects)f(are)g(accessed)g(e)o(xclusi)n(v)o
(ely)f(through)1992 3648 y(k)o(ernel-implemented,)27
b(secure)i(capabilities.)53 b(Posession)29 b(of)g(a)1992
3748 y(k)o(e)o(y)e(for)h(an)g(object)g(is)h(a)g(necessary)e
Fl(and)h(suf)o(\002cient)g Fr(condition)1992 3847 y(for)20
b(accessing)g(that)h(object)f(with)h(the)g(authorities)f(con)m(v)o(e)o
(yed)e(by)1992 3947 y(that)32 b(k)o(e)o(y)-5 b(.)59 b(A)33
b(read-write)e(page)g(k)o(e)o(y)-5 b(,)34 b(for)d(e)o(xample,)j(con)m
(v)o(e)o(ys)1992 4047 y(the)22 b(authority)e(to)i(e)o(xamine)f(or)g
(modify)g(a)h(particular)f(persistent)1992 4146 y(page.)1992
4279 y(Ev)o(ery)31 b(node)g(and)i(page)f(has)g(a)i(unique)d(\(possibly)
g(duple)o(x)o(ed\))1992 4379 y Fi(home)f(location)p Fr(,)h(which)f
(de\002nes)g(the)g(object')-5 b(s)31 b(unique)d(iden-)1992
4478 y(ti\002er)c(\(OID\).)f(Main)h(memory)e(is)j(used)f(as)h(a)g
(cache)e(of)h(the)g(per)n(-)1992 4578 y(sistent)e(store.)30
b(When)21 b(a)h(k)o(e)o(y)f(is)i(referenced,)d(the)h(object)h(named)
1992 4678 y(by)c(the)g(k)o(e)o(y)g(is)i(f)o(aulted)e(into)g(memory)f
(from)g(the)i(disk.)24 b(Once)19 b(the)1992 4777 y(object)k(is)i(in)f
(memory)-5 b(,)23 b(the)h(referencing)e(in)m(v)n(ocation)g(proceeds)
1992 4877 y(on)15 b(the)g(in-memory)f(cop)o(y)-5 b(.)22
b(At)16 b(some)g(later)f(time,)i(the)f(object)f(will)1992
4977 y(be)j(written)h(back)g(to)g(the)g(persistent)g(store,)g(making)e
(the)j(modi\002-)1992 5076 y(cation)f(permanent.)24 b(Ef)n(\002cienc)o
(y)18 b(is)k(achie)n(v)o(ed)c(by)i(cacheing)f(this)1992
5176 y(state)25 b(in)h(a)f(form)g(con)m(v)o(enient)d(to)j(the)h(hardw)o
(are,)e(and)h(ensuring)1992 5275 y(that)20 b(the)g(cached)f(images)h
(and)g(the)g(objects)g(remain)f(consistent.)1992 5408
y(Objects)27 b(on)g(the)g(persistent)g(store)g(are)h(or)o(ganized)c(in)
j(contigu-)p eop
%%Page: 2 3
2 2 bop 0 -199 a Fh(2)83 b(THE)20 b(PERSISTENCE)g(LA)-9
b(YER)2723 b Fr(2)0 91 y(ously)27 b(numbered)d(clusters)k(kno)n(wn)d
(as)j Fi(ranges)p Fr(.)45 b(Ev)o(ery)26 b(range)0 191
y(has)f(a)g(type)f(\(node)f(or)h(page\),)g(a)h(starting)f(OID,)g(and)g
(an)h(ending)0 291 y(OID.)f(Once)h(the)f(appropriate)f(range)g(is)j
(located,)f(the)f(of)n(fset)g(of)0 390 y(that)d(object)f(within)h(the)g
(range)f(can)g(be)h(calculated)f(by)h(straight-)0 490
y(forw)o(ard)e(arithmetic.)0 755 y Fg(2.1)99 b(The)26
b(Object)g(Cache)0 944 y Fr(At)g(startup)e(time,)i(the)f(ER)m(OS)h(k)o
(ernel)e(allocates)h(a)h(small)f(num-)0 1043 y(ber)j(of)g(static)h
(data)f(structures.)49 b(Machine)27 b(con\002guration)f(and)0
1143 y(dri)n(v)o(er)g(initialization)h(code)f(then)h(allocate)g(whate)n
(v)o(er)f(dedicat-)0 1242 y(ed)32 b(memory)e(is)i(required)e(to)i
(support)f(the)g(hardw)o(are)g(present)0 1342 y(on)22
b(the)g(machine.)30 b(All)23 b(remaining)d(memory)h(is)i(used)f(as)h
(an)f(ob-)0 1442 y(ject)29 b(cache)f(for)h(nodes)f(and)g(pages.)50
b(On)29 b(a)g(Pentium)f(PC)i(with)0 1541 y(16)21 b(Me)o(gabytes)e(of)i
(memory)-5 b(,)19 b(our)i(\(bloated\))e(research)h(k)o(ernel')-5
b(s)0 1641 y(object)20 b(cache)f(holds)h(3497)f(pages)h(and)f(3572)g
(nodes.)0 1774 y(Prior)34 b(to)g(its)h(\002rst)g(use,)i(a)e(k)o(e)o(y)e
(to)h(a)h(node)e(or)g(page)h(contains)0 1873 y(a)c(type,)h(a)f(16-bit)e
(k)o(e)o(y)h(data)g(\002eld,)j(the)d(object)g(identi\002er)m(,)i(and)0
1973 y(the)22 b(object')-5 b(s)22 b(allocation)f(count.)29
b(The)22 b(format)f(of)h(such)f(a)i(k)o(e)o(y)e(is)0
2073 y(sho)n(wn)e(in)i(Figure)e(2.)196 2177 y
 11972280 3683778 0 0 11972280 3683778 startTexFig
 196 2177
a
%%BeginDocument: DiskObKey.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: DiskObKey.fig
%%Creator: fig2dev Version 3.2 Patchlevel 1
%%CreationDate: Wed Oct 13 21:20:36 1999
%%For: shapj@bonzo.watson.ibm.com (Jonathan Shapiro)
%%Orientation: Portrait
%%BoundingBox: 0 0 182 56
%%Pages: 0
%%BeginSetup
%%EndSetup
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-17.0 73.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def
%%EndProlog

$F2psBegin
10 setmiterlimit
n -1000 2212 m -1000 -1000 l 4312 -1000 l 4312 2212 l cp clip
 0.06000 0.06000 sc
% Polyline
7.500 slw
n 1050 300 m 1800 300 l 1800 525 l 1050 525 l cp gs col-1 s gr 
% Polyline
n 300 300 m 1050 300 l 1050 525 l 300 525 l cp gs col-1 s gr 
% Polyline
n 1800 300 m 3300 300 l 3300 525 l 1800 525 l cp gs col-1 s gr 
% Polyline
n 3300 525 m 3300 750 l 300 750 l 300 525 l cp gs col-1 s gr 
% Polyline
n 3300 975 m 3300 1200 l 300 1200 l 300 975 l cp gs col-1 s gr 
% Polyline
n 1800 750 m 3300 750 l 3300 975 l 1800 975 l cp gs col-1 s gr 
% Polyline
n 300 750 m 1800 750 l 1800 975 l 300 975 l cp gs col-1 s gr 
/Times-Bold ff 150.00 scf sf
675 450 m
gs 1 -1 sc (Type) col-1 sh gr
/Times-Bold ff 150.00 scf sf
375 450 m
gs 1 -1 sc (000) col-1 sh gr
/Times-Bold ff 150.00 scf sf
1425 1125 m
gs 1 -1 sc (OID[31:0]) col-1 sh gr
/Times-Bold ff 150.00 scf sf
1200 675 m
gs 1 -1 sc (Allocation Count[31:0]) col-1 sh gr
/Times-Bold ff 150.00 scf sf
675 900 m
gs 1 -1 sc (OID[47:32]) col-1 sh gr
/Times-Bold ff 150.00 scf sf
1950 900 m
gs 1 -1 sc (Alloc Count[47:32]) col-1 sh gr
/Times-Bold ff 150.00 scf sf
2175 450 m
gs 1 -1 sc (Key Data) col-1 sh gr
/Times-Bold ff 150.00 scf sf
1125 450 m
gs 1 -1 sc (SubType) col-1 sh gr
$F2psEnd
rs

%%EndDocument

 endTexFig
 473 2826 a Fr(Figure)h(2:)25 b(An)20 b(unprepared)d(k)o(e)o(y)0
3128 y(Objects)f(in)f(memory)f(are)h(link)o(ed)g(into)g(a)h(hash)f
(table)g(on)g(the)g(basis)0 3228 y(of)31 b(their)h(OID.)f(When)g(a)h(k)
o(e)o(y)f(to)h(an)f(object)g(is)i(\002rst)f(in)m(v)n(ok)o(ed,)0
3327 y(the)20 b(object)g(cache)f(hash)h(table)g(is)h(searched)f(to)g
(determine)f(if)h(the)0 3427 y(object)k(is)i(in)f(core.)38
b(If)25 b(necessary)-5 b(,)24 b(an)h(object)f(f)o(ault)h(is)g
(initiated)0 3527 y(to)20 b(bring)f(the)i(object)e(into)h(the)g(main)g
(memory)f(cache.)0 3659 y(Once)k(the)g(object)g(is)h(found)e(in)h
(memory)f(it)i(is)g(consulted)e(to)h(lo-)0 3759 y(cate)18
b(its)g(current)e Fi(object)h(table)g(entry)p Fr(.)23
b(If)18 b(no)f(object)g(table)g(entry)0 3859 y(e)o(xists)i(for)f(the)h
(object,)f(one)h(is)g(allocated)f(from)g(the)h Fi(cor)o(e)f(object)0
3958 y(table)p Fr(.)31 b(The)22 b(object)f(and)h(the)g(object)g(table)g
(entry)g(point)f(to)h(each)0 4058 y(other)-5 b(.)48 b(When)28
b(an)g(object)g(table)g(entry)f(has)h(been)g(located,)h(the)0
4158 y(k)o(e)o(y)e(is)h(con)m(v)o(erted)c(into)j(its)i
Fl(pr)m(epar)m(ed)f Fr(form,)f(which)g(points)g(to)0
4257 y(the)18 b(object)g(table)g(entry)-5 b(.)24 b(This)18
b(pro)o(vides)f(ef)n(\002cient)h(access)h(to)f(the)0
4357 y(object)g(for)g(future)g(references.)23 b(The)18
b(prepared)f(form)h(of)g(the)h(k)o(e)o(y)0 4456 y(is)i(sho)n(wn)f(in)g
(Figure)f(3.)0 4721 y Fg(2.2)99 b(Object)26 b(V)-10 b(ersions)0
4910 y Fr(All)17 b(pages)f(and)f(nodes)h(are)g(initially)g(o)n(wned)f
(by)h(a)h(user)n(-le)n(v)o(el)e(do-)0 5010 y(main)k(kno)n(wn)f(as)j
(the)e Fi(space)h(bank)h Fr(\(see)e(belo)n(w\).)24 b(Applications)0
5109 y(wishing)d(to)h(obtain)f(storage)h(must)g(obtain)f(that)h
(storage)f(from)g(a)0 5209 y(space)g(bank.)26 b(A)c(space)f(bank)f
(holds)g(the)h(authority)f(to)h(f)o(abricate)0 5309 y(page)j(and)h
(node)e(k)o(e)o(ys)i(for)f(all)i(of)f(the)f(objects)h(in)g(the)g
(ranges)f(it)0 5408 y(controls.)g(Space)c(banks)f(are)i(trusted)e
(system)i(components.)2150 8 y
 12564316 6643957 0 0 12564316 6643957 startTexFig
 2150 8 a
%%BeginDocument: PrepObject.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: PrepObject.fig
%%Creator: fig2dev Version 3.2 Patchlevel 1
%%CreationDate: Wed Oct 13 21:20:36 1999
%%For: shapj@bonzo.watson.ibm.com (Jonathan Shapiro)
%%Orientation: Portrait
%%BoundingBox: 0 0 191 101
%%Pages: 0
%%BeginSetup
%%EndSetup
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-8.0 118.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def
%%EndProlog

$F2psBegin
10 setmiterlimit
n -1000 2964 m -1000 -1000 l 4312 -1000 l 4312 2964 l cp clip
 0.06000 0.06000 sc
% Polyline
7.500 slw
n 1050 300 m 1800 300 l 1800 525 l 1050 525 l cp gs col-1 s gr 
% Polyline
n 300 300 m 1050 300 l 1050 525 l 300 525 l cp gs col-1 s gr 
% Polyline
n 1800 300 m 3300 300 l 3300 525 l 1800 525 l cp gs col-1 s gr 
% Polyline
n 3300 525 m 3300 750 l 300 750 l 300 525 l cp gs col-1 s gr 
% Polyline
n 3300 975 m 3300 1200 l 300 1200 l 300 975 l cp gs col-1 s gr 
% Polyline
gs  clippath
330 1545 m 450 1575 l 330 1605 l 465 1605 l 465 1545 l cp
clip
n 450 1050 m 150 1050 l 150 1575 l 450 1575 l gs col-1 s gr gr

% arrowhead
n 330 1545 m 450 1575 l 330 1605 l 330 1575 l 330 1545 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
n 2325 1350 m 3076 1350 l 3076 1950 l 2325 1950 l cp gs col-1 s gr 
% Polyline
gs  clippath
2205 1770 m 2325 1800 l 2205 1830 l 2340 1830 l 2340 1770 l cp
clip
n 1575 1800 m 2325 1800 l gs col-1 s gr gr

% arrowhead
n 2205 1770 m 2325 1800 l 2205 1830 l 2205 1800 l 2205 1770 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
1845 1605 m 1725 1575 l 1845 1545 l 1710 1545 l 1710 1605 l cp
clip
n 2400 1575 m 1725 1575 l gs col-1 s gr gr

% arrowhead
n 1845 1605 m 1725 1575 l 1845 1545 l 1845 1575 l 1845 1605 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
n 452 1502 m 1727 1502 l 1727 1727 l 452 1727 l cp gs col-1 s gr 
% Polyline
n 452 1727 m 1727 1727 l 1727 1952 l 452 1952 l cp gs col-1 s gr 
% Polyline
n 1800 750 m 3300 750 l 3300 975 l 1800 975 l cp gs col-1 s gr 
% Polyline
n 300 750 m 1800 750 l 1800 975 l 300 975 l cp gs col-1 s gr 
/Times-Bold ff 150.00 scf sf
675 450 m
gs 1 -1 sc (Type) col-1 sh gr
/Times-Bold ff 150.00 scf sf
375 450 m
gs 1 -1 sc (001) col-1 sh gr
/Times-Bold ff 150.00 scf sf
1275 1125 m
gs 1 -1 sc (Object Table Ptr) col-1 sh gr
/Times-Bold ff 150.00 scf sf
1125 675 m
gs 1 -1 sc (Allocation Count[31:0]) col-1 sh gr
/Times-BoldItalic ff 150.00 scf sf
2550 1576 m
gs 1 -1 sc (Page) col-1 sh gr
/Times-BoldItalic ff 150.00 scf sf
2626 1726 m
gs 1 -1 sc (or) col-1 sh gr
/Times-BoldItalic ff 150.00 scf sf
2550 1876 m
gs 1 -1 sc (Node) col-1 sh gr
/Times-BoldItalic ff 150.00 scf sf
525 1425 m
gs 1 -1 sc (Object Table Entry) col-1 sh gr
/Times-Bold ff 150.00 scf sf
752 1652 m
gs 1 -1 sc (OID[31:0]) col-1 sh gr
/Times-Bold ff 150.00 scf sf
752 1877 m
gs 1 -1 sc (Object Ptr) col-1 sh gr
/Times-Bold ff 150.00 scf sf
1875 900 m
gs 1 -1 sc (Alloc Count[47:32]) col-1 sh gr
/Times-Bold ff 150.00 scf sf
750 900 m
gs 1 -1 sc (OID[47:32]) col-1 sh gr
/Times-Bold ff 150.00 scf sf
2100 450 m
gs 1 -1 sc (Key Data) col-1 sh gr
/Times-Bold ff 150.00 scf sf
1125 450 m
gs 1 -1 sc (SubType) col-1 sh gr
$F2psEnd
rs

%%EndDocument

 endTexFig
 2527 1033 a Fr(Figure)f(3:)25 b(A)c(prepared)d(k)o(e)o(y)1992
1416 y(Ov)o(er)j(the)h(course)g(of)g(its)h(lifetime,)f(a)h(gi)n(v)o(en)
d(page)i(or)g(node)f(may)1992 1516 y(be)38 b(acquired)f(and)g
(relinquished)g(by)h(man)o(y)f(dif)n(ferent)g(users.)1992
1616 y(K)n(e)o(ys)18 b(to)h(this)g(object)f(can)h(be)g(copied)e
(arbitrarily)g(by)i(the)f(holder)m(,)1992 1715 y(so)24
b(it)g(is)h(necessary)e(to)g(ha)n(v)o(e)h(a)g(w)o(ay)f(to)h(ensure)f
(that)h(a)g(pre)n(vious)1992 1815 y(user)29 b(cannot)g(access)i(the)f
(ne)n(w)f(user')-5 b(s)31 b(data.)54 b(This)30 b(is)h(accom-)1992
1915 y(plished)22 b(by)g(use)g(of)h(a)g(48)f(bit)h Fi(allocation)e
(count)p Fr(,)i(which)f(tracks)1992 2014 y(the)30 b(number)e(of)i
(times)h(that)f(an)h(object)e(has)i(been)e(allocated.)3868
1984 y Ff(1)1992 2114 y Fr(Both)18 b(the)g(object)g(and)g(it')-5
b(s)19 b(associated)f(k)o(e)o(ys)h(ha)n(v)o(e)e(an)i(allocation)1992
2213 y(count.)1992 2346 y(Whene)n(v)o(er)35 b(a)j(prepared)e(k)o(e)o(y)
g(is)j(referenced,)g(the)f(allocation)1992 2446 y(count)21
b(of)h(the)g(k)o(e)o(y)f(is)j(compared)c(against)h(the)h(allocation)g
(count)1992 2546 y(stored)f(in)h(the)f(object)h(header)-5
b(.)2892 2515 y Ff(2)2954 2546 y Fr(If)21 b(the)h(allocation)f(count)g
(in)h(the)1992 2645 y(k)o(e)o(y)f(does)g(not)h(match)f(the)h
(allocation)f(count)g(in)h(the)g(object,)g(the)1992 2745
y(k)o(e)o(y)g(is)j(in)m(v)n(alid,)d(and)h(con)m(v)o(e)o(ys)f(no)h
(authority)e(on)i(the)h(object.)34 b(A)1992 2844 y(k)o(e)o(y)21
b(that)h(is)g(disco)o(v)o(ered)e(to)i(ha)n(v)o(e)f(an)h(in)m(v)n(alid)f
(in)m(v)n(ocation)f(count)1992 2944 y(is)i(con)m(v)o(erted)e(by)h(the)h
(k)o(ernel)f(to)h(a)h Fl(number)e(k)o(e)n(y)h Fr(containing)e(the)1992
3044 y(number)e(0.)1992 3177 y(When)f(an)h(object)g(is)h(sold)f(back)f
(to)h(a)g(space)g(bank,)g(its)h(allocation)1992 3276
y(count)31 b(is)i(incremented.)60 b(This)32 b(is)h(kno)n(wn)e(as)i
Fl(r)m(escinding)f Fr(the)1992 3376 y(object,)22 b(and)f(ensures)h
(that)h(\223dangling)d(k)o(e)o(ys\224)i(to)g(the)h(object)f(are)1992
3475 y(rendered)c(impotent.)1992 3608 y(The)32 b(decision)g(to)h
(accept)f(an)h(e)o(xtra)f(le)n(v)o(el)g(of)g(indirection)f(for)1992
3708 y(k)o(e)o(y)22 b(v)n(alidation)f(is)j(a)f(deliberate)f
(engineering)e(tradeof)n(f.)31 b(In)23 b(the)1992 3807
y(v)n(ast)18 b(majority)g(of)g(k)o(e)o(y)g(in)m(v)n(ocations,)g(only)f
(one)i(k)o(e)o(y)f(needs)g(to)h(be)1992 3907 y(v)n(alidated)25
b(for)h(the)g(in)m(v)n(ocation)e(to)j(proceed.)42 b(K)n(e)o(y)26
b(in)m(v)n(ocation-)1992 4007 y(s)d(in)m(v)n(olv)o(e)e(a)i(pri)n(vile)o
(ge)e(transition,)h(so)h(the)g(additional)e(memory)1992
4106 y(reference)e(is)k(essentially)e(lost)h(in)g(the)f(noise)g(on)g
(most)h(architec-)1992 4206 y(tures.)1992 4339 y(In)29
b(the)g(case)h(of)f(an)h(interdomain)d(call,)32 b(se)n(v)o(eral)d(k)o
(e)o(ys)g(may)g(be)p 1992 4460 764 4 v 2082 4515 a Fe(1)2111
4539 y Fj(Gi)n(v)o(en)19 b(that)g(the)g(designed)h(MTBF)d(of)h(the)h
(ER)m(OS)e(system)h(is)g(measured)h(in)1992 4617 y(years,)24
b(the)f(possibility)i(of)d(allocation)k(count)e(o)o(v)o(er\003o)n(w)g
(must)e(be)h(considered.)1992 4696 y(Assuming)f(a)g(32)h(c)o(ycle)h
(round-trip)g(in)m(v)o(ocation)i(time)d(\(an)f(implausibly)j(small)1992
4775 y(number\),)e(a)e(48)h(bit)h(counter)g(tak)o(es)g
Fd(2)2898 4752 y Fc(53)2985 4775 y Fj(c)o(ycles)g(to)f(roll)h(o)o(v)o
(er)l(.)36 b(On)21 b(a)h(machine)1992 4854 y(with)e(a)g(femtosecond)i
(\()p Fd(2)2594 4831 y Fk(\000)p Fc(15)2727 4854 y Fj(sec\))e(clock,)i
(this)e(w)o(orks)h(out)f(something)h(o)o(v)o(er)g(8)1992
4933 y(thousand)e(years.)25 b(While)19 b(its)f(concei)n(v)n(able)23
b(that)c(a)f(single)i(system)e(image)h(might)1992 5012
y(run)25 b(that)j(long,)g(we)e(feel)h(reasonably)h(con\002dent)g(that)f
(we)f(can)g(sca)o(v)o(enge)i(the)1992 5091 y(persistent)19
b(store)e(e)n(v)o(ery)i(fe)n(w)e(thousand)i(years)f(without)g
(noticable)i(o)o(v)o(erhead.)2082 5148 y Fe(2)2111 5172
y Fj(Node)e(object)h(headers)g(are)f(k)o(ept)h(with)f(the)g(object.)24
b(Hardw)o(are)19 b(constraints)1992 5251 y(require)g(that)f(pages)g(be)
g(placed)h(in)f(physical)h(memory)f(at)f(page)i(addresses.)k(The)1992
5329 y(object)16 b(\223headers\224)h(for)d(pages)h(are)h(k)o(ept)f(in)g
(a)f(parallel)k(data)d(structure)i(rather)f(than)1992
5408 y(with)h(the)h(page)g(itself.)p eop
%%Page: 3 4
3 3 bop 0 -199 a Fh(3)83 b(THE)20 b(ER)m(OS)g(ABSTRA)m(CT)h(MA)m(CHINE)
2486 b Fr(3)0 91 y(copied)18 b(by)h(a)g(k)o(e)o(y)f(in)m(v)n(ocation.)
23 b(Copied)c(k)o(e)o(ys)f(need)h(not)f(be)h(v)n(ali-)0
191 y(dated;)g(if)g(the)g(original)f(is)i(stale,)g(the)f(cop)o(y)f
(will)h(be)g(just)h(as)g(stale,)0 291 y(and)g(can)g(be)g(in)m(v)n
(alidated)e(in)i(a)h(lazy)f(f)o(ashion.)0 592 y Fg(2.3)99
b(Ageing)25 b(and)g(Sca)n(v)o(enging)0 787 y Fr(Objects)j(are)h(placed)
e(on)h(a)h(\223free)e(list\224)j(by)d(an)i(ager)m(,)g(and)e(real-)0
887 y(located)d(in)h(response)f(to)h(memory)f(demands.)37
b(Objects)26 b(on)e(the)0 987 y(free)f(list)i(retain)e(their)g
(content,)g(and)g(can)g(be)g(reco)o(v)o(ered)e(if)j(the)o(y)0
1086 y(are)c(disco)o(v)o(ered)e(to)i(be)h(in)f(acti)n(v)o(e)g(use.)0
1219 y(When)30 b(a)g(node)f(is)i(remo)o(v)o(ed)c(from)i(memory)f(by)i
(the)g(ager)m(,)h(its)0 1319 y(contained)20 b(k)o(e)o(ys)g(are)i
(\002rst)g(con)m(v)o(erted)c(to)k(their)f(on-disk)e(format.)0
1418 y(If)25 b(the)g(k)o(e)o(y)f(is)i(prepared,)e(its)j(associated)d
(object)h(table)g(entry)f(is)0 1518 y(consulted)j(to)i(obtain)f(the)h
(lo)n(w)g(w)o(ord)f(of)g(the)h(k)o(e)o(y')-5 b(s)28 b(OID,)h(and)0
1618 y(this)21 b(OID)f(is)h(re)n(written)f(into)f(the)i(k)o(e)o(y)e
(data)h(structure.)0 1751 y(The)c(object)g(named)f(by)h(a)h(k)o(e)o(y)f
(may)g(be)g(remo)o(v)o(ed)e(from)i(memory)0 1850 y(before)22
b(the)h(k)o(e)o(y)g(is)h(remo)o(v)o(ed.)31 b(When)23
b(this)h(occurs,)f(no)f(attempt)0 1950 y(is)h(made)e(to)h(locate)f(the)
h(k)o(e)o(ys)f(that)h(point)f(to)h(the)g(corresponding)0
2049 y(object)27 b(table)g(entry)-5 b(.)45 b(The)27 b(object)g(pointer)
f(\002eld)h(of)g(the)h(object)0 2149 y(table)20 b(entry)g(is)h(simply)f
(set)i(to)e Fb(1)p Fr(,)h(rendering)d(the)i(object)g(pointer)0
2249 y(in)m(v)n(alid)15 b(\(the)h(lo)n(w)g(bit)g(is)h(tested)g(whene)n
(v)o(er)d(a)i(k)o(e)o(y)g(is)h(referenced\).)0 2382 y(As)23
b(an)g(ef)n(\002cienc)o(y)-5 b(,)21 b(a)i(ne)n(w)f(object)g(table)h
(entry)e(is)j(allocated)e(e)n(v-)0 2481 y(ery)h(time)h(an)g(in-core)e
(object)i(is)g(rescinded.)35 b(In)23 b(this)i(e)n(v)o(ent,)e(the)0
2581 y(object)d(pointer)f(\002eld)i(is)g(set)h(to)f Fb(3)p
Fr(.)26 b(This)21 b(allo)n(ws)f(in)m(v)n(alid)g(k)o(e)o(ys)g(to)0
2680 y(be)c(deprepared)d(to)j(the)g(null)g(k)o(e)o(y)-5
b(,)15 b(which)h(eliminates)g(the)g(need)f(to)0 2780
y(f)o(ault)20 b(in)g(the)h(object)e(later)i(to)f(disco)o(v)o(er)e(that)
j(the)f(k)o(e)o(y)g(is)h(in)m(v)n(alid.)0 2913 y(Stale)26
b(object)g(table)g(entries)f(are)h(reco)o(v)o(ered)d(by)j(the)g
Fi(O)m(T)g(Sca)n(v-)0 3012 y(enger)p Fr(,)19 b(a)g(lo)n(w-priority)d
(background)g(task.)24 b(The)19 b(O)m(T)f(sca)n(v)o(enger)0
3112 y(\002rst)30 b(passes)g(o)o(v)o(er)e(the)h(object)g(table)g
(entries,)i(using)e(an)g(a)n(v)n(ail-)0 3212 y(able)35
b(bit)h(in)f(the)g(in)m(v)n(alid)g(object)f(pointer)g(to)i(indicate)f
(which)0 3311 y(entries)30 b(are)f(to)h(be)g(cleaned.)52
b(It)30 b(then)g(passes)g(through)d(k)o(e)o(y)j(s-)0
3411 y(pace,)25 b(depreparing)d(all)j(k)o(e)o(ys)f(that)h(reference)e
(object)h(table)g(en-)0 3511 y(tries)32 b(mark)o(ed)d(for)i(cleaning.)
56 b(Finally)-5 b(,)33 b(it)f(frees)f(those)g(object)0
3610 y(table)22 b(entries.)31 b(Making)20 b(tw)o(o)j(passes)g(o)o(v)o
(er)d(the)i(object)g(table)g(al-)0 3710 y(lo)n(ws)j(the)h(O)m(T)f(sca)n
(v)o(enger)f(to)h(operate)f(without)g(disrupting)g(on-)0
3809 y(going)19 b(computation.)0 4154 y Fm(3)119 b(The)31
b(ER)l(OS)f(Abstract)g(Machine)0 4379 y Fr(ER)m(OS)20
b(de\002nes)g(an)g(abstract)g(machine)e(using)i(nodes)f(and)g(pages)0
4478 y(as)37 b(the)f(basic)g(b)n(uilding)f(blocks.)72
b(The)36 b(abstract)g(machine)f(is)0 4578 y(mapped)27
b(onto)h(the)g(underlying)e(hardw)o(are)h(using)h(the)g(mecha-)0
4678 y(nisms)22 b(described)f(later)g(in)h(this)h(paper)-5
b(.)29 b(W)m(ith)22 b(the)f(e)o(xception)f(of)0 4777
y(threads,)h(all)i(of)e(the)h(pieces)g(of)g(the)g(abstract)f(machine)g
(are)h(b)n(uilt)0 4877 y(out)31 b(of)g(nodes)f(and)h(pages,)j(and)c
(therefore)g(inherit)g(their)h(per)n(-)0 4977 y(sistence.)37
b(Thread)23 b(persistence)h(is)h(managed)d(specially)i(by)g(the)0
5076 y(k)o(ernel.)0 5209 y(The)19 b(ER)m(OS)h(abstract)f(machine)f(e)o
(xposes)g(the)h(basic)h(node,)e(page)0 5309 y(and)25
b(thread)g(objects,)i(and)f(pro)o(vides)e(four)h(additional)g(abstrac-)
0 5408 y(tions:)53 b Fl(domains)p Fr(,)36 b Fl(se)m(gments)p
Fr(,)g(and)e Fl(stall)g(queues)f Fr(\(the)h(last,)k(a)1992
91 y(means)24 b(for)h(arranging)e(ef)n(\002cient)i(in)m(v)n(ocation)e
(retry)-5 b(,)25 b(is)i(not)d(dis-)1992 191 y(cussed)j(by)g(this)i
(paper\).)46 b(In)27 b(addition,)h(the)g(abstract)g(machine)1992
291 y(de\002nes)19 b(the)g(mechanism)f(by)h(which)g(objects)h(are)f
(accessed:)25 b Fl(in-)1992 390 y(vocation)p Fr(.)1992
661 y Fg(3.1)99 b(Domains)1992 850 y Fr(Domains)20 b(are)h(assembled)g
(from)f(nodes,)g(one)h(of)f(which)h(acts)h(as)1992 950
y(the)e Fi(domain)g(r)o(oot)p Fr(.)2571 919 y Ff(3)2628
950 y Fr(A)g(domain)f(consists)i(of:)2075 1149 y Fa(\017)41
b Fr(An)28 b Fl(addr)m(ess)g(space)f(se)m(gment)p Fr(,)i(containing)e
(the)h(program)2158 1248 y(that)c(the)g(domain)f(obe)o(ys)g(and)h(an)o
(y)f(data)h(that)h(the)f(domain)2158 1348 y(may)19 b(construct.)2075
1514 y Fa(\017)41 b Fr(A)27 b(set)g(of)f Fl(g)o(ener)o(al)g(r)m(e)m
(gister)o(s)p Fr(,)j(which)d(change)f(as)j(the)e(do-)2158
1614 y(main)k(e)o(x)o(ecutes.)54 b(The)30 b(re)o(gister)g(set)h
(includes)e(all)i(of)g(the)2158 1713 y(non-pri)n(vile)o(ged)d(re)o
(gisters)k(of)g(the)h(underlying)d(machine)2158 1813
y(architecture.)2075 1979 y Fa(\017)41 b Fr(A)21 b(set)h(of)f(16)g
Fl(k)o(e)n(y)g(r)m(e)m(gister)o(s)p Fr(,)h(which)f(identify)f(the)i
(services)2158 2079 y(that)e(the)g(domain)f(can)h(in)m(v)n(ok)o(e.)2075
2245 y Fa(\017)41 b Fr(A)22 b(priority)e(k)o(e)o(y)-5
b(,)22 b(de\002ning)e(the)i(priority)f(at)h(which)f(the)h(do-)2158
2344 y(main)d(should)h(be)g(scheduled.)2075 2510 y Fa(\017)41
b Fr(A)24 b Fl(k)o(eeper)p Fr(,)h(which)f(is)h(a)f Fl(start)h(k)o(e)n
(y)f Fr(\(see)g(belo)n(w\))g(to)g(anoth-)2158 2610 y(er)29
b(domain)g(that)h(is)h(in)m(v)n(ok)o(ed)d(when)h(a)h(domain)e(tak)o(es)
j(an)2158 2710 y(e)o(xception.)26 b(The)21 b(k)o(eeper)f(is)j
(established)d(when)h(a)h(domain)2158 2809 y(is)k(\002rst)g(created.)40
b(Most)25 b(domains)g(are)g(unable)f(to)i(change)2158
2909 y(their)19 b(k)o(eeper)-5 b(.)1992 3108 y(Re)o(gister)21
b(v)n(alues)g(in)h(a)g(domain)e(are)i(stored)f(in)h Fl(number)f(k)o(e)n
(ys)p Fr(.)29 b(A)1992 3208 y Fi(number)21 b(k)o(ey)g
Fr(is)g(a)g(self-describing)e(capability)g(containing)g(\(in)1992
3307 y(the)28 b(current)e(implementation\))g(a)i(10)g(byte)g(data)f
(string.)3689 3277 y Ff(4)3771 3307 y Fr(The)1992 3407
y(zero)19 b(number)g(k)o(e)o(y)g(is)i(also)g(kno)n(wn)d(as)j(the)g
Fi(null)g(k)o(ey)p Fr(.)1992 3661 y Fi(3.1.1)81 b(User)m(-De\002ned)20
b(Objects)1992 3850 y Fr(A)f(domain)f(acts)i(as)g(the)g(interpreter)e
(of)h(the)g(program)e(contained)1992 3950 y(in)26 b(its)i(address)e
(space,)h(interpreting)e(that)h(program)f(according)1992
4049 y(to)k(the)h(user)n(-mode)e(instruction)g(set)i(of)f(the)h
(underlying)d(hard-)1992 4149 y(w)o(are)21 b(architecture.)26
b(In)20 b(this)i(sense,)g(domains)e(are)h(both)f(objects)1992
4249 y(in)f(their)h(o)n(wn)f(right)g(and)g(implementors)f(of)i
(objects.)k(The)c(hold-)1992 4348 y(er)j(of)h(a)g Fi(domain)g(k)o(ey)g
Fr(can)f(f)o(abricate)g(a)h(k)o(e)o(y)f(kno)n(wn)f(as)j(a)f
Fi(start)1992 4448 y(k)o(ey)p Fr(.)36 b(The)23 b(in)m(v)n(ok)o(er)f(of)
i(a)g(start)g(k)o(e)o(y)g(in)m(v)n(ok)o(es)e(the)i(program)e(em-)1992
4548 y(bodied)f(in)i(that)g(domain.)31 b(Once)22 b(started,)h(the)g
(program)e(runs)h(at)1992 4647 y(the)e(priority)f(of)g(its)j
(interpreting)c(domain.)1992 4780 y(The)d Fi(k)o(ey)i(data)e
Fr(\002eld)i(of)e(a)i(start)g(k)o(e)o(y)e(is)i(set)g(as)g(part)f(of)g
(its)h(f)o(abrica-)1992 4880 y(tion,)22 b(and)g(is)i(passed)f(to)f(the)
h(recipient)f(program)e(by)j(the)f(k)o(ernel)p 1992 4933
764 4 v 2082 4988 a Fe(3)2111 5012 y Fj(In)k(all)g(current)h
(implementations,)k(domains)26 b(occup)o(y)i(three)f(nodes:)39
b(the)1992 5091 y(domain)18 b(root,)g(the)g(general)i(re)o(gisters)f
(node,)f(and)g(the)h(k)o(e)o(y)f(re)o(gisters)i(node.)j(The)1992
5169 y(general)18 b(re)o(gisters)h(node)f(holds)f(an)o(y)g(re)o(gister)
i(v)n(alues)f(that)h(do)d(not)i(\002t)f(within)h(the)1992
5248 y(domain)f(root,)h(and)f(may)g(turn)h(out)f(not)h(to)f(be)g
(required)i(for)e(i486)h(domains.)2082 5306 y Fe(4)2111
5329 y Fj(ER)m(OS)g(k)o(e)o(ys)i(will)f(shortly)h(be)f(gro)n(wing)h
(from)e(3)h(w)o(ords)g(to)f(4.)26 b(The)18 b(size)i(of)1992
5408 y(the)d(number)h(k)o(e)o(y)g(payload)h(will)e(gro)n(w)h
(accordingly)l(.)p eop
%%Page: 4 5
4 4 bop 0 -199 a Fh(3)83 b(THE)20 b(ER)m(OS)g(ABSTRA)m(CT)h(MA)m(CHINE)
2486 b Fr(4)0 91 y(whene)n(v)o(er)18 b(that)j(start)g(k)o(e)o(y)f(is)h
(in)m(v)n(ok)o(ed.)j(Because)d(it)g(does)f(not)g(o-)0
191 y(riginate)h(with)g(the)g(caller)m(,)g(the)h(k)o(e)o(y)f(data)g(v)n
(alue)f(is)j(unfor)o(geable.)0 291 y(It)17 b(can)g(be)g(used)g(by)g
(the)g(recei)n(ving)e(program)g(to)j(denote)e(multiple)0
390 y(clients,)k(multiple)g(authorities,)f(or)h(choose)f(among)g
(interf)o(aces.)0 642 y Fi(3.1.2)81 b(Domain)20 b(States)0
831 y Fr(In)44 b(addition)g(to)g(pro)o(viding)e(services,)51
b(domains)43 b(pro)o(vide)g(a)0 931 y(mechanism)d(for)g
(synchronization.)85 b(Domains)40 b(are)i(single-)0 1031
y(threaded.)73 b(A)38 b(domain)d(can)i(be)g(occupied)e(by)h(at)i(most)f
(one)0 1130 y(thread.)c(If)23 b(a)g(client)g(in)m(v)n(ok)o(es)f(a)i
(domain)e(that)h(is)h(currently)d(run-)0 1230 y(ning,)15
b(the)g(client)h(blocks)e(until)h(the)h(domain)d(becomes)i(a)n(v)n
(ailable.)0 1329 y(More)20 b(precisely)-5 b(,)18 b(a)j(domain)e(can)h
(be)g(in)g(one)g(of)g(three)g(states:)0 1520 y Fi(A)-8
b(v)o(ailable)40 b Fr(An)20 b Fl(available)f Fr(domain)f(is)j
(currently)e(idle,)h(and)f(can)166 1619 y(be)h(in)m(v)n(ok)o(ed)e(by)h
(an)o(y)g(holder)f(of)i(an)g(appropriate)d Fl(start)j(k)o(e)n(y)p
Fr(.)166 1719 y(This)d(is)g(the)f(state)h(of)f(most)h(of)f(the)g
(domains)f(in)i(the)f(system.)166 1818 y(An)25 b(a)n(v)n(ailable)g
(domain)e(is)j(not)f(occupied)e(by)i(an)o(y)f(thread.)166
1918 y(A)g(domain)e(becomes)g(a)n(v)n(ailable)h(when)g(it)h(performs)d
(a)j Fl(r)m(e-)166 2018 y(turn)c Fr(operation.)0 2179
y Fi(Running)42 b Fr(Once)d(it)h(has)g(been)f(in)m(v)n(ok)o(ed,)k(a)d
(domain)e(mo)o(v)o(es)166 2279 y(from)23 b(the)h(a)n(v)n(ailable)f
(state)h(to)g(the)g Fl(running)e Fr(state.)37 b(A)24
b(run-)166 2378 y(ning)h(domain)f(is)j(b)n(usy)e(servicing)g(an)g(in)m
(v)n(ocation,)g(and)g(is)166 2478 y(occupied)c(by)h(a)h(thread.)31
b(If)22 b(a)h(start)g(k)o(e)o(y)f(is)h(in)m(v)n(ok)o(ed)e(while)166
2578 y(the)29 b(domain)g(is)h(running,)f(the)h(in)m(v)n(ok)o(er)e(will)
i(block)e(until)166 2677 y(the)20 b(domain)f(becomes)g
Fl(available)p Fr(.)0 2839 y Fi(W)-5 b(aiting)40 b Fr(A)23
b(domain)d(that)i(has)g(in)m(v)n(ok)o(ed)e(a)j(k)o(e)o(y)e(and)g(is)i
(w)o(aiting)166 2938 y(for)28 b(a)g(response)g(mo)o(v)o(es)f(from)g
(the)i Fl(running)d Fr(state)k(to)e(the)166 3038 y Fl(waiting)21
b Fr(state.)29 b(It)22 b(remains)e(in)i(this)g(state)g(until)f(its)h
(current)166 3138 y(resume)17 b(k)o(e)o(y)h(is)h(in)m(v)n(ok)o(ed.)j
(If)c(a)h(start)f(k)o(e)o(y)g(is)h(in)m(v)n(ok)o(ed)d(while)166
3237 y(the)g(domain)f(is)i(w)o(aiting,)f(the)h(in)m(v)n(ok)o(er)d(will)
j(block)e(until)h(the)166 3337 y(domain)j(becomes)g Fl(available)p
Fr(.)0 3589 y Fi(3.1.3)81 b(Domain)20 b(K)n(eepers)0
3778 y Fr(As)k(a)g(domain)d(interprets)i(a)g(program,)f(it)i(may)f(tak)
o(e)g Fi(execution)0 3878 y(faults)16 b Fr(due)f(to)h(in)m(v)n(alid)f
(or)h(pri)n(vile)o(ged)d(instructions,)j(inappropri-)0
3977 y(ate)k(runtime)f(data)h(v)n(alues,)f(or)g(e)o(x)o(ecution)f(of)i
(a)g(trap)g(instruction.)0 4077 y(Except)26 b(in)h(the)g(case)g(of)f
(the)h(k)o(e)o(y)f(in)m(v)n(ocation)f(trap,)j(the)f(ER)m(OS)0
4177 y(k)o(ernel)e(does)h(not)g(directly)g(resolv)o(e)f(such)h(f)o
(aults.)43 b(Instead,)27 b(the)0 4276 y(k)o(ernel)d(encapsulates)g(the)
h(f)o(ault)f(into)h(a)g(message)g(and)f(deli)n(v)o(ers)0
4376 y(this)31 b(message)f(to)g(the)h(domain')-5 b(s)29
b(k)o(eeper)-5 b(.)55 b(The)30 b(k)o(eeper)f(is)i(re-)0
4475 y(sponsible)19 b(for)h(deciding)f(what)h(to)g(do.)1131
4445 y Ff(5)0 4608 y Fr(Ex)o(ecution)d(f)o(aults)i(are)g(distinguished)
f(from)g(access)h(f)o(aults.)25 b Fi(Ac-)0 4708 y(cess)19
b(faults)f Fr(include)f(references)f(to)i(in)m(v)n(alid)f(pages)g(and)h
(access-)0 4807 y(es)30 b(to)f(pages)g(mapped)e(with)j(insuf)n
(\002cient)e(access)h(rights.)52 b(If)29 b(a)p 0 4856
764 4 v 90 4912 a Fe(5)120 4935 y Fj(A)c(notable)k(e)o(xception)g(is)e
(softw)o(are)h(emulation)g(of)e(unimplemented)k(in-)0
5014 y(structions)19 b(or)e(unimplemented)j(boundary)f(conditions,)g
(which)f(are)g(performed)0 5093 y(transparently)24 b(by)d(the)g(k)o
(ernel)i(in)e(some)f(implementations.)35 b(Emulation)22
b(could)0 5172 y(in)c(f)o(act)g(be)g(handled)h(by)e(the)h(domain)g(k)o
(eeper)m(,)i(b)o(ut)d(this)h(w)o(ould)g(place)h(an)f(unnec-)0
5251 y(essary)h(b)o(urden)h(of)f(implementation)j(on)d(all)h(k)o
(eepers)g(and)f(render)h(them)g(highly)0 5329 y(machine)28
b(dependent.)50 b(On)26 b(balance,)31 b(it)c(appears)g(that)g(in-k)o
(ernel)i(instruction)0 5408 y(emulation)19 b(is)e(a)g(better)i
(solution)g(pro)o(vided)f(it)g(is)f(not)g(e)o(xcessi)n(v)o(e.)1992
91 y Fl(se)m(gment)24 b(k)o(eeper)k Fr(\(see)d(belo)n(w\))g(is)h
(de\002ned,)g(access)g(f)o(aults)g(will)1992 191 y(be)k(deli)n(v)o
(ered)f(to)i(the)g(se)o(gment)e(k)o(eeper)h(in)h(preference)e(to)i(the)
1992 291 y(domain)e(k)o(eeper)-5 b(.)58 b(The)31 b(se)o(gment)f(k)o
(eeper)g(recei)n(v)o(es)h(suf)n(\002cien-)1992 390 y(t)c(authority)e
(to)i(pass)g(the)f(f)o(ault)h(message)g(back)e(to)i(the)g(domain)1992
490 y(k)o(eeper)19 b(for)g(resolution.)1992 623 y(Note)e(that)g(both)g
(access)g(and)g(e)o(x)o(ecution)e(f)o(aults)j(are)f Fl(endo)o(g)o
(enous)1992 722 y Fr(f)o(aults.)38 b(Both)24 b(can)h(be)f(traced)g
(directly)g(to)h(some)f(action)g(by)h(the)1992 822 y(program.)d(It)d
(is)h(the)f(responsibility)f(of)h(the)g(k)o(eeper\(s\))e(to)j(handle)
1992 922 y(endogenous)c(f)o(aults.)25 b(Exogenous)17
b(f)o(aults,)i(such)h(as)g(memory)e(er)n(-)1992 1021
y(rors,)h(are)g(the)h(responsibility)e(of)i(the)g(ER)m(OS)g(k)o(ernel.)
k(A)c(domain)1992 1121 y(that)28 b(tak)o(es)h(an)f(endogenous)e(f)o
(ault)i(without)g(a)h(k)o(eeper)f(de\002ned)1992 1220
y(becomes)19 b Fi(br)o(ok)o(en)p Fr(,)h(and)f(ceases)i(to)f(e)o(x)o
(ecute)f(instructions.)1992 1353 y(The)i(essential)h(notion)f(behind)f
(k)o(eepers)h(is)i(that)f(whate)n(v)o(er)e(may)1992 1453
y(pro)o(v)o(e)e(to)j(be)f(wrong,)f(the)i(k)o(ernel)e(lacks)i(suf)n
(\002cient)f(information)1992 1553 y(to)i(correct)f(the)i(problem.)29
b(It)23 b(is)g(better)f(to)g(place)g(f)o(ault)g(handling)1992
1652 y(in)30 b(a)i(user)e(domain)f(which)i(might)f(be)g(able)h(to)g(do)
f(something)1992 1752 y(constructi)n(v)o(e)18 b(to)i(address)g(the)g
(problem.)1992 2028 y Fg(3.2)99 b(Segments)1992 2217
y Fr(A)16 b Fi(segment)f Fr(pro)o(vides)f(a)i(mapping)e(from)h(of)n
(fsets)g(to)h(pages)f(\(Fig-)1992 2317 y(ure)k(4\).)25
b(Se)o(gments)19 b(serv)o(e)g(as)i(both)e(the)h(\002les)g(and)g(the)g
(address)f(s-)1992 2417 y(paces)i(of)h(the)g(ER)m(OS)g(system.)30
b(Se)o(gments)21 b(are)h(tree-structured,)1992 2516 y(follo)n(wing)f
(the)j(style)g(of)f(traditional)f(tree-structured)f(mapping)1992
2616 y(tables.)34 b(Each)22 b(layer)h(in)g(the)g(se)o(gment)g(tree)g
(translates)g(four)f(bits)1992 2716 y(of)d(a)i(se)o(gment)e(of)n(fet.)
1996 2835 y
 14998241 9669918 0 0 14998241 9669918 startTexFig
 1996 2835 a
%%BeginDocument: seg19pg.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: seg19pg.fig
%%Creator: fig2dev Version 3.2 Patchlevel 1
%%CreationDate: Wed Oct 13 21:20:36 1999
%%For: shapj@bonzo.watson.ibm.com (Jonathan Shapiro)
%%Orientation: Portrait
%%BoundingBox: 0 0 228 147
%%Pages: 0
%%BeginSetup
%%EndSetup
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def
/col32 {0.894 0.635 0.000 srgb} bind def

end
save
-6.0 152.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def
%%EndProlog

$F2psBegin
10 setmiterlimit
n -1000 3532 m -1000 -1000 l 4885 -1000 l 4885 3532 l cp clip
 0.06000 0.06000 sc
% Polyline
7.500 slw
n 752 228 m 827 228 l 827 628 l 752 628 l cp gs col-1 s gr 
% Polyline
n 827 228 m 902 228 l 902 628 l 827 628 l cp gs col-1 s gr 
% Polyline
n 902 228 m 977 228 l 977 628 l 902 628 l cp gs col-1 s gr 
% Polyline
n 977 228 m 1053 228 l 1053 628 l 977 628 l cp gs col-1 s gr 
% Polyline
n 1053 228 m 1128 228 l 1128 628 l 1053 628 l cp gs col-1 s gr 
% Polyline
n 1128 228 m 1203 228 l 1203 628 l 1128 628 l cp gs col-1 s gr 
% Polyline
n 1203 228 m 1277 228 l 1277 628 l 1203 628 l cp gs col-1 s gr 
% Polyline
n 1277 228 m 1352 228 l 1352 628 l 1277 628 l cp gs col-1 s gr 
% Polyline
n 1352 228 m 1428 228 l 1428 628 l 1352 628 l cp gs col-1 s gr 
% Polyline
n 1428 228 m 1502 228 l 1502 628 l 1428 628 l cp gs col-1 s gr 
% Polyline
n 1502 228 m 1577 228 l 1577 628 l 1502 628 l cp gs col-1 s gr 
% Polyline
n 1577 228 m 1652 228 l 1652 628 l 1577 628 l cp gs col-1 s gr 
% Polyline
n 1728 228 m 1803 228 l 1803 628 l 1728 628 l cp gs col-1 s gr 
% Polyline
n 1652 228 m 1728 228 l 1728 628 l 1652 628 l cp gs col-1 s gr 
% Polyline
n 228 1054 m 303 1054 l 303 1454 l 228 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 303 1054 m 378 1054 l 378 1454 l 303 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 378 1054 m 453 1054 l 453 1454 l 378 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 453 1054 m 528 1054 l 528 1454 l 453 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 528 1054 m 603 1054 l 603 1454 l 528 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 603 1054 m 678 1054 l 678 1454 l 603 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 678 1054 m 753 1054 l 753 1454 l 678 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 753 1054 m 828 1054 l 828 1454 l 753 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 828 1054 m 903 1054 l 903 1454 l 828 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 903 1054 m 978 1054 l 978 1454 l 903 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 978 1054 m 1053 1054 l 1053 1454 l 978 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 1053 1054 m 1128 1054 l 1128 1454 l 1053 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 1128 1054 m 1203 1054 l 1203 1454 l 1128 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 1203 1054 m 1278 1054 l 1278 1454 l 1203 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 1278 1054 m 1353 1054 l 1353 1454 l 1278 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 1353 1054 m 1428 1054 l 1428 1454 l 1353 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
/Times-Roman ff 90.00 scf sf
153 1155 m
gs 1 -1 sc (0) col-1 sh gr
/Times-Roman ff 90.00 scf sf
1466 1155 m
gs 1 -1 sc (15) col-1 sh gr
% Polyline
n 1952 1053 m 2027 1053 l 2027 1454 l 1952 1454 l cp gs col-1 s gr 
% Polyline
n 2027 1053 m 2102 1053 l 2102 1454 l 2027 1454 l cp gs col-1 s gr 
% Polyline
n 2102 1053 m 2177 1053 l 2177 1454 l 2102 1454 l cp gs col-1 s gr 
% Polyline
n 2177 1053 m 2252 1053 l 2252 1454 l 2177 1454 l cp gs col-1 s gr 
% Polyline
n 2252 1053 m 2327 1053 l 2327 1454 l 2252 1454 l cp gs col-1 s gr 
% Polyline
n 2327 1053 m 2403 1053 l 2403 1454 l 2327 1454 l cp gs col-1 s gr 
% Polyline
n 2403 1053 m 2478 1053 l 2478 1454 l 2403 1454 l cp gs col-1 s gr 
% Polyline
n 2478 1053 m 2553 1053 l 2553 1454 l 2478 1454 l cp gs col-1 s gr 
% Polyline
n 2553 1053 m 2628 1053 l 2628 1454 l 2553 1454 l cp gs col-1 s gr 
% Polyline
n 2628 1053 m 2702 1053 l 2702 1454 l 2628 1454 l cp gs col-1 s gr 
% Polyline
n 2702 1053 m 2777 1053 l 2777 1454 l 2702 1454 l cp gs col-1 s gr 
% Polyline
n 2777 1053 m 2852 1053 l 2852 1454 l 2777 1454 l cp gs col-1 s gr 
% Polyline
n 2852 1053 m 2928 1053 l 2928 1454 l 2852 1454 l cp gs col-1 s gr 
% Polyline
n 1877 1053 m 1952 1053 l 1952 1454 l 1877 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 2928 1053 m 3003 1053 l 3003 1454 l 2928 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 3003 1053 m 3078 1053 l 3078 1454 l 3003 1454 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 2055 479 m 2055 369 l 2535 369 l 2535 479 l cp gs col-1 s gr 
% Polyline
n 603 228 m 677 228 l 677 628 l 603 628 l cp gs col7 0.95 shd ef gr gs col-1 s gr 
% Polyline
n 677 228 m 752 228 l 752 628 l 677 628 l cp gs col7 0.95 shd ef gr gs col-1 s gr 
/Times-Roman ff 90.00 scf sf
528 329 m
gs 1 -1 sc (0) col-1 sh gr
/Times-Roman ff 90.00 scf sf
1840 329 m
gs 1 -1 sc (15) col-1 sh gr
/Times-Roman ff 90.00 scf sf
1802 1153 m
gs 1 -1 sc (0) col-1 sh gr
/Times-Roman ff 90.00 scf sf
3115 1153 m
gs 1 -1 sc (15) col-1 sh gr
% Polyline
gs  clippath
255 930 m 225 1050 l 195 930 l 195 1065 l 255 1065 l cp
clip
n 630 375 m 630 750 l 225 750 l 225 1050 l gs col-1 s gr gr

% arrowhead
n 255 930 m 225 1050 l 195 930 l 225 930 l 255 930 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
1920 915 m 1890 1035 l 1860 915 l 1860 1050 l 1920 1050 l cp
clip
n 720 390 m 720 750 l 1890 750 l 1890 1035 l gs col-1 s gr gr

% arrowhead
n 1920 915 m 1890 1035 l 1860 915 l 1890 915 l 1920 915 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
246 1681 m 180 1785 l 189 1662 l 147 1790 l 204 1809 l cp
clip
n 255 1215 m 255 1560 l 180 1785 l gs col-1 s gr gr

% arrowhead
n 246 1681 m 180 1785 l 189 1662 l 218 1671 l 246 1681 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
n 390 1770 m 525 1770 l 525 1920 l 390 1920 l cp gs col-1 s gr 
% Polyline
n 645 1770 m 780 1770 l 780 1920 l 645 1920 l cp gs col-1 s gr 
% Polyline
n 885 1770 m 1020 1770 l 1020 1920 l 885 1920 l cp gs col-1 s gr 
% Polyline
n 1110 1770 m 1245 1770 l 1245 1920 l 1110 1920 l cp gs col-1 s gr 
% Polyline
n 1335 1770 m 1470 1770 l 1470 1920 l 1335 1920 l cp gs col-1 s gr 
% Polyline
n 1560 1770 m 1695 1770 l 1695 1920 l 1560 1920 l cp gs col-1 s gr 
% Polyline
n 1785 1770 m 1920 1770 l 1920 1920 l 1785 1920 l cp gs col-1 s gr 
% Polyline
n 120 1770 m 255 1770 l 255 1920 l 120 1920 l cp gs col-1 s gr 
% Polyline
n 240 2010 m 375 2010 l 375 2160 l 240 2160 l cp gs col-1 s gr 
% Polyline
n 510 2025 m 645 2025 l 645 2175 l 510 2175 l cp gs col-1 s gr 
% Polyline
n 750 2025 m 885 2025 l 885 2175 l 750 2175 l cp gs col-1 s gr 
% Polyline
n 975 2025 m 1110 2025 l 1110 2175 l 975 2175 l cp gs col-1 s gr 
% Polyline
n 1230 2025 m 1365 2025 l 1365 2175 l 1230 2175 l cp gs col-1 s gr 
% Polyline
n 1455 2025 m 1590 2025 l 1590 2175 l 1455 2175 l cp gs col-1 s gr 
% Polyline
n 1680 2025 m 1815 2025 l 1815 2175 l 1680 2175 l cp gs col-1 s gr 
% Polyline
n 1950 2025 m 2085 2025 l 2085 2175 l 1950 2175 l cp gs col-1 s gr 
% Polyline
gs  clippath
1746 1681 m 1845 1755 l 1723 1737 l 1847 1788 l 1870 1733 l cp
clip
n 1305 1215 m 1305 1530 l 1845 1755 l gs col-1 s gr gr

% arrowhead
n 1746 1681 m 1845 1755 l 1723 1737 l 1734 1709 l 1746 1681 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
1525 1676 m 1620 1755 l 1499 1730 l 1620 1789 l 1647 1735 l cp
clip
n 1155 1230 m 1155 1530 l 1620 1755 l gs col-1 s gr gr

% arrowhead
n 1525 1676 m 1620 1755 l 1499 1730 l 1512 1703 l 1525 1676 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
1305 1670 m 1395 1755 l 1276 1723 l 1393 1789 l 1423 1736 l cp
clip
n 1020 1245 m 1020 1545 l 1395 1755 l gs col-1 s gr gr

% arrowhead
n 1305 1670 m 1395 1755 l 1276 1723 l 1290 1696 l 1305 1670 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
1096 1656 m 1170 1755 l 1058 1703 l 1163 1788 l 1201 1741 l cp
clip
n 855 1230 m 855 1500 l 1170 1755 l gs col-1 s gr gr

% arrowhead
n 1096 1656 m 1170 1755 l 1058 1703 l 1077 1679 l 1096 1656 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
890 1668 m 960 1770 l 850 1713 l 951 1802 l 991 1757 l cp
clip
n 705 1230 m 705 1545 l 960 1770 l gs col-1 s gr gr

% arrowhead
n 890 1668 m 960 1770 l 850 1713 l 870 1691 l 890 1668 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
660 1640 m 705 1755 l 611 1675 l 689 1785 l 738 1750 l cp
clip
n 555 1230 m 555 1545 l 705 1755 l gs col-1 s gr gr

% arrowhead
n 660 1640 m 705 1755 l 611 1675 l 635 1657 l 660 1640 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
349 1876 m 315 1995 l 289 1874 l 285 2009 l 344 2011 l cp
clip
n 330 1215 m 330 1545 l 315 1995 l gs col-1 s gr gr

% arrowhead
n 349 1876 m 315 1995 l 289 1874 l 319 1875 l 349 1876 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
600 1890 m 570 2010 l 540 1890 l 540 2025 l 600 2025 l cp
clip
n 480 1230 m 480 1530 l 570 1770 l 570 2010 l gs col-1 s gr gr

% arrowhead
n 600 1890 m 570 2010 l 540 1890 l 570 1890 l 600 1890 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
855 1905 m 825 2025 l 795 1905 l 795 2040 l 855 2040 l cp
clip
n 630 1215 m 630 1530 l 825 1740 l 825 2025 l gs col-1 s gr gr

% arrowhead
n 855 1905 m 825 2025 l 795 1905 l 825 1905 l 855 1905 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
1095 1890 m 1065 2010 l 1035 1890 l 1035 2025 l 1095 2025 l cp
clip
n 780 1230 m 780 1530 l 1065 1740 l 1065 2010 l gs col-1 s gr gr

% arrowhead
n 1095 1890 m 1065 2010 l 1035 1890 l 1065 1890 l 1095 1890 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
469 1631 m 465 1755 l 411 1644 l 439 1776 l 497 1763 l cp
clip
n 405 1215 m 420 1545 l 465 1755 l gs col-1 s gr gr

% arrowhead
n 469 1631 m 465 1755 l 411 1644 l 440 1638 l 469 1631 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
1312 1892 m 1275 2010 l 1252 1888 l 1244 2023 l 1304 2027 l cp
clip
n 930 1215 m 945 1530 l 1290 1755 l 1275 2010 l gs col-1 s gr gr

% arrowhead
n 1312 1892 m 1275 2010 l 1252 1888 l 1282 1890 l 1312 1892 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
1537 1892 m 1500 2010 l 1477 1888 l 1469 2023 l 1529 2027 l cp
clip
n 1080 1215 m 1080 1515 l 1515 1755 l 1500 2010 l gs col-1 s gr gr

% arrowhead
n 1537 1892 m 1500 2010 l 1477 1888 l 1507 1890 l 1537 1892 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
1770 1905 m 1740 2025 l 1710 1905 l 1710 2040 l 1770 2040 l cp
clip
n 1230 1230 m 1230 1515 l 1740 1770 l 1740 2025 l gs col-1 s gr gr

% arrowhead
n 1770 1905 m 1740 2025 l 1710 1905 l 1740 1905 l 1770 1905 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
2048 1904 m 2025 2025 l 1988 1907 l 1996 2042 l 2056 2038 l cp
clip
n 1380 1215 m 1395 1500 l 2010 1755 l 2025 2025 l gs col-1 s gr gr

% arrowhead
n 2048 1904 m 2025 2025 l 1988 1907 l 2018 1905 l 2048 1904 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
n 2355 1710 m 2490 1710 l 2490 1860 l 2355 1860 l cp gs col-1 s gr 
% Polyline
n 2820 1710 m 2955 1710 l 2955 1860 l 2820 1860 l cp gs col-1 s gr 
% Polyline
n 3045 1710 m 3180 1710 l 3180 1860 l 3045 1860 l cp gs col-1 s gr 
% Polyline
gs  clippath
2265 1645 m 2370 1710 l 2247 1702 l 2375 1743 l 2393 1686 l cp
clip
n 1905 1200 m 1905 1560 l 2370 1710 l gs col-1 s gr gr

% arrowhead
n 2265 1645 m 2370 1710 l 2247 1702 l 2256 1673 l 2265 1645 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
2972 1598 m 2895 1695 l 2917 1573 l 2861 1696 l 2916 1721 l cp
clip
n 2970 1185 m 2970 1530 l 2895 1695 l gs col-1 s gr gr

% arrowhead
n 2972 1598 m 2895 1695 l 2917 1573 l 2945 1586 l 2972 1598 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
3073 1576 m 3105 1695 l 3020 1605 l 3086 1723 l 3139 1694 l cp
clip
n 3030 1185 m 3030 1560 l 3105 1695 l gs col-1 s gr gr

% arrowhead
n 3073 1576 m 3105 1695 l 3020 1605 l 3047 1590 l 3073 1576 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
n 2056 249 m 2056 135 l 2559 135 l 2559 249 l cp gs col7 0.75 shd ef gr gs col-1 s gr 
% Polyline
n 2040 704 m 2040 584 l 2549 584 l 2549 704 l cp gs col7 0.95 shd ef gr gs col-1 s gr 
/Times-Bold ff 150.00 scf sf
2282 987 m
gs 1 -1 sc (Node) col-1 sh gr
/Times-Bold ff 150.00 scf sf
677 1002 m
gs 1 -1 sc (Node) col-1 sh gr
/Times-Bold ff 150.00 scf sf
782 2487 m
gs 1 -1 sc (Pages) col-1 sh gr
/Times-Bold ff 150.00 scf sf
1007 192 m
gs 1 -1 sc (Node) col-1 sh gr
/Times-Bold ff 150.00 scf sf
2676 705 m
gs 1 -1 sc (Node Key) col-1 sh gr
/Times-Bold ff 150.00 scf sf
2670 500 m
gs 1 -1 sc (Zero Number Key) col-1 sh gr
/Times-Bold ff 150.00 scf sf
2683 249 m
gs 1 -1 sc (Page Key) col-1 sh gr
$F2psEnd
rs

%%EndDocument

 endTexFig
 2463 4243 a Fr(Figure)h(4:)25 b(A)c(19)e(page)h(se)o(gment)1992
4561 y(Ev)o(ery)26 b(domain)h(has)i(an)f(associated)h(address)e(space)i
(se)o(gment,)1992 4660 y(which)d(is)i(referenced)d(by)i(load)g(and)g
(store)g(instructions.)45 b(Pro-)1992 4760 y(grams)15
b(access)i(other)e(se)o(gments)h(by)g(mapping)e(portions)h(of)h(them)
1992 4860 y(into)j(their)h(address)g(space)g(se)o(gment.)1992
5119 y Fi(3.2.1)81 b(Segment)20 b(K)n(eepers)1992 5309
y Fr(Se)o(gment)35 b(k)o(eepers)h(subsume)g(most)h(of)f(the)h(memory)e
(polic)o(y)1992 5408 y(management)29 b(decisions)j(of)g(con)m(v)o
(entional)c(k)o(ernels.)60 b(Just)33 b(as)p eop
%%Page: 5 6
5 5 bop 0 -199 a Fh(4)83 b(REALIZING)19 b(THE)h(MA)m(CHINE)2703
b Fr(5)0 91 y(programs)27 b(can)h(e)o(x)o(ecute)f(in)m(v)n(alid)h
(instructions,)h(the)o(y)f(can)g(per)n(-)0 191 y(form)14
b(in)m(v)n(alid)h(references.)22 b(A)16 b(se)o(gment)e(can)h
(optionally)f(pro)o(vide)0 291 y(a)i Fl(start)h(k)o(e)n(y)f
Fr(to)f(a)i Fi(segment)f(k)o(eeper)p Fr(,)h(a)f(domain)e(that)i(should)
f(han-)0 390 y(dle)29 b(access)g(f)o(aults)f(encountered)e(within)i
(that)h(se)o(gment.)49 b(This)0 490 y(recei)n(v)o(es)25
b(noti\002cation)f(of)i(both)e(in)m(v)n(alid)h(accesses)h(and)f
(protec-)0 589 y(tion)20 b(violations.)0 722 y(A)26 b(se)o(gment)f(k)o
(eeper)f(can)i(respond)e(to)i(a)g(se)o(gment)e(f)o(ault)i(in)g(one)0
822 y(of)20 b(tw)o(o)g(w)o(ays:)26 b(it)21 b(can)f(modify)e(the)i(se)o
(gment)f(so)i(as)g(to)f(allo)n(w)g(the)0 922 y(access)d(to)g(proceed,)f
(or)g(it)i(can)e(decide)g(that)h(the)g(reference)e(is)j(tru-)0
1021 y(ly)24 b(in)m(v)n(alid)e(and)i(hand)e(of)n(f)h(the)h
(responsibility)e(to)i(the)g(domain')-5 b(s)0 1121 y(domain)26
b(k)o(eeper)-5 b(.)46 b(Object)27 b(cache)g(misses)h(are)f(not)g
(reported)f(to)0 1220 y(the)f(se)o(gment)f(k)o(eeper)m(,)h(b)n(ut)g
(are)h(transparently)d(handled)g(by)i(the)0 1320 y(object)20
b(cache.)0 1598 y Fg(3.3)99 b(Thr)n(eads)0 1788 y Fr(A)23
b Fi(thr)o(ead)e Fr(binds)h(a)h(domain)e(to)h(a)h(particular)e
(machine.)30 b(In)23 b(this)0 1888 y(capacity)-5 b(,)33
b(threads)e(may)g(be)h(thought)e(of)h(as)i(the)e(roots)h(of)f(the)0
1987 y(state)e(reachable)d(from)h(a)i(gi)n(v)o(en)d(host.)48
b(A)29 b(running)d(domain)g(is)0 2087 y(occupied)14 b(by)h(a)h(thread,)
g(and)f(e)o(x)o(ecutes)f(instructions)h(on)g(the)h(host)0
2187 y(identi\002ed)h(by)h(the)g(thread.)23 b(A)18 b(host)g(implements)
f(a)i(\002x)o(ed)e(supply)0 2286 y(of)j(threads.)0 2419
y(Threads)26 b(are)h(the)g(unit)f(of)h(scheduling)e(in)i(the)g(ER)m(OS)
g(abstract)0 2519 y(machine.)22 b(When)16 b(a)h(domain)e(calls)i
(another)d(domain,)i(the)g(thread)0 2618 y(is)21 b(said)g(to)f
Fl(migr)o(ate)g Fr(to)g(the)g(called)g(domain.)0 2896
y Fg(3.4)99 b(In)l(v)o(ocation)25 b(and)g(Messages)0
3086 y Fr(A)18 b(program)d(wishing)j(to)f(access)h(an)g(object)f(must)h
(possess)g(a)g(k)o(e)o(y)0 3186 y(naming)28 b(that)i(object.)54
b(Access)30 b(is)h(obtained)e(by)g Fl(in)m(voking)f Fr(the)0
3286 y(k)o(e)o(y)j(with)h(a)f(message)h(that)f(is)i(deli)n(v)o(ered)d
(to)h(the)h(object.)58 b(An)0 3385 y(ER)m(OS)31 b(message)f(consists)h
(of)f(an)h Fi(order)f(code)p Fr(,)j(e)o(xactly)c(four)0
3485 y(k)o(e)o(ys,)22 b(and)g(a)h(contiguous)e(data)h(string)g(of)g(up)
g(to)h(64)f(kilobytes.)1877 3455 y Ff(6)0 3585 y Fr(Message)f
(responses)g(contain)f(a)i Fi(r)o(etur)o(n)e(code)p Fr(,)i(four)e(k)o
(e)o(ys,)h(and)0 3684 y(up)i(to)h(64K)f(of)g(data.)35
b(K)n(e)o(y)23 b(re)o(gister)g(zero)g(of)h(e)n(v)o(ery)e(domain)g(al-)0
3784 y(w)o(ays)28 b(contains)e(the)i(null)f(k)o(e)o(y)-5
b(.)45 b(If)27 b(sending)f(or)h(recei)n(ving)f(four)0
3883 y(k)o(e)o(ys)j(is)g(not)g(required)e(for)h(a)i(gi)n(v)o(en)d
(message,)k(unneeded)c(k)o(e)o(y)0 3983 y(ar)o(guments)17
b(can)i(be)g(sent)g(from)g(or)f(recei)n(v)o(ed)g(to)h(k)o(e)o(y)g(re)o
(gister)f(ze-)0 4083 y(ro.)0 4216 y(ER)m(OS)26 b(supports)e(three)h
(types)g(of)g(in)m(v)n(ocation:)34 b Fl(call)p Fr(,)26
b Fl(fork)p Fr(,)h(and)0 4315 y Fl(r)m(eturn)p Fr(.)d(The)15
b Fi(call)h Fr(in)m(v)n(ocation)e(passes)j(a)g Fi(r)o(esume)f(k)o(ey)g
Fr(in)g(the)g(last)0 4415 y(slot)k(of)e(the)i(message)e(\(o)o(v)o
(erwriting)f(an)o(y)h(k)o(e)o(y)g(sent)i(in)f(that)g(slot\),)0
4514 y(and)k(places)h(the)g(in)m(v)n(oking)e(domain)h(in)h(the)g
Fl(waiting)g Fr(state)g(until)0 4614 y(the)c(generated)d(resume)i(k)o
(e)o(y)g(is)i(in)m(v)n(ok)o(ed.)i(The)c(recipient)g(object)0
4714 y(is)h(placed)e(in)h(the)g Fl(running)e Fr(state)j(as)f(a)h
(consequence)c(of)j(the)g(call.)0 4813 y(The)h Fi(r)o(etur)o(n)g
Fr(in)m(v)n(ocation)f(is)i(the)f(in)m(v)o(erse)g(of)g(the)g(call)h
(operation.)0 4913 y(It)16 b(places)g(the)f(in)m(v)n(ok)o(er)f(in)i
(the)g Fl(available)e Fr(state)i(and)f(the)h(recipient)0
5013 y(in)32 b(the)f Fl(running)f Fr(state.)60 b(Resume)32
b(k)o(e)o(ys)f(are)h(self-consuming;)0 5112 y(an)o(y)26
b(in)m(v)n(ocation)f(of)i(a)g(resume)g(k)o(e)o(y)f(causes)h(all)h
(copies)e(of)h(that)p 0 5172 764 4 v 90 5227 a Fe(6)120
5251 y Fj(The)19 b(current)i(implementation)i(restricts)e(messages)f
(to)f(be)h(no)f(lar)o(ger)i(than)0 5329 y(the)16 b(architecture')l(s)k
(page)d(size.)k(W)-5 b(e)15 b(plan)h(to)g(e)o(xtend)i(message)e(data)h
(payloads)g(to)0 5408 y(64K)g(shortly)l(.)1992 91 y Fr(resume)i(k)o(e)o
(y)g(to)h(be)f(ef)n(\002ciently)g(in)m(v)n(alidated.)k(This)d(ensures)f
(that)1992 191 y(e)n(v)o(ery)f(call)j(recei)n(v)o(es)e(at)i(most)f(one)
g(reply)-5 b(.)1992 324 y(The)18 b Fi(f)n(ork)h Fr(in)m(v)n(ocation)f
(transfers)g(the)i(message)f(to)g(the)h(recipient)1992
423 y(and)k(lea)n(v)o(es)i(both)f(sender)f(and)h(recei)n(v)o(er)f(in)i
(the)f Fl(running)f Fr(state.)1992 523 y(Unless)g(the)g(caller)g(mak)o
(es)g(e)o(xplicit)g(pro)o(vision)e(for)h(a)h(reply)-5
b(,)24 b(no)1992 623 y(response)19 b(to)h(a)h(fork)e(is)i(possible.)
1992 756 y(Because)27 b(domains)f(are)h(single-threaded,)f(entry)g(to)h
(a)h(domain)1992 855 y(pro)o(vides)21 b(an)j(implicit)f(guarantee)f(of)
h(mutual)f(e)o(xclusion.)33 b(This)1992 955 y(f)o(act)20
b(is)h(e)o(xploited)e(by)g(a)i(number)d(of)i(dif)n(ferent)f(ER)m(OS)h
(objects.)1992 1283 y Fm(4)119 b(Realizing)31 b(the)f(Machine)1992
1505 y Fr(The)15 b(abstract)g(machine)f(must)i(be)f(mapped)f(onto)h
(the)g(underlying)1992 1604 y(hardw)o(are.)28 b(This)22
b(is)g(principally)f(a)h(matter)f(of)h(constructing)e(the)1992
1704 y(appropriate)d(mapping)h(table)h(structures)g(and)g(\002nding)g
(a)h(w)o(ay)f(to)1992 1803 y(structure)d(conte)o(xt)h(information)f(to)
i(f)o(acilitate)g(ef)n(\002cient)f(conte)o(x-)1992 1903
y(t)27 b(switching.)43 b(ER)m(OS)27 b(vie)n(ws)f(the)h(mapping)d
(tables)j(as)g(a)g(cache)1992 2003 y(of)22 b(the)h(state)g(embodied)e
(in)i(the)g(se)o(gment)f(structures.)32 b(An)o(y)22 b(do-)1992
2102 y(main)29 b(state)h(that)g(is)h(needed)d(for)h(ef)n(\002cient)h
(conte)o(xt)e(switching)1992 2202 y(is)c(maintained)e(in)i(the)g
Fi(context)e(cache)p Fr(.)36 b(F)o(or)23 b(both)g(caches,)h(de-)1992
2302 y(pendenc)o(y)d(structures)h(are)i(maintained)e(that)i(allo)n(w)f
(the)h(caches)1992 2401 y(to)19 b(be)h(in)m(v)n(alidated)e(as)i
(objects)g(are)f(modi\002ed)g(or)g(remo)o(v)o(ed)f(from)1992
2501 y(memory)-5 b(.)1992 2634 y(The)36 b(design)h(of)f(the)i
(dependenc)o(y)33 b(mechanisms)k(must)g(meet)1992 2733
y(three)19 b(objecti)n(v)o(es:)2054 2939 y(1.)41 b(Ne)n(w)c(dependenc)o
(y)c(structures)k(must)g(be)f(constructable)2158 3039
y(without)27 b(long)g(delay)-5 b(,)28 b(if)g(necessary)f(by)h
(reclaiming)e(oth-)2158 3138 y(er)20 b(dependenc)o(y-related)15
b(data)20 b(structures.)2054 3317 y(2.)41 b(It)20 b(must)h(be)g
(possible)f(to)h(reclaim)f(dependenc)o(y)d(structures)2158
3417 y(incrementally)-5 b(.)2054 3596 y(3.)41 b(The)15
b(dependenc)o(y)d(structures)j(must)g(f)o(acilitate)h(an)f(ef)n
(\002cient)2158 3696 y(realization)k(of)h(ageing)f(and)g
(checkpointing.)1992 3901 y(In)h(this)h(section)g(we)g(present)f(the)h
(dependenc)o(y)d(tracking)i(mech-)1992 4001 y(anisms)g(that)g(ER)m(OS)h
(uses)g(to)f(realize)g(the)g(abstract)g(machine.)1992
4287 y Fg(4.1)99 b(K)n(ey)24 b(Slot)h(Hazards)1992 4478
y Fr(Because)c(a)g(k)o(e)o(y')-5 b(s)20 b(v)n(alue)h(may)f(be)h
(cached,)f(care)g(must)h(be)g(tak)o(en)1992 4578 y(when)k(reading)g(or)
i(writing)e(k)o(e)o(y)h(slots)h(to)g(ensure)f(that)g(an)o(y)g(de-)1992
4678 y(pendent)16 b(cache)j(information)d(is)j(appropriately)d
(\003ushed)i(and/or)1992 4777 y(updated.)35 b(Such)23
b(a)i(condition)d(is)k(kno)n(wn)c(in)i(ER)m(OS)h(k)o(ernel)e(ter)n(-)
1992 4877 y(minology)e(as)k(a)f Fi(hazard)p Fr(.)35 b(Hazards)23
b(are)h(di)n(vided)e(into)h(tw)o(o)h(\003a-)1992 4977
y(v)n(ors:)h(read)19 b(hazards)h(and)f(write)i(hazards.)1992
5109 y(A)i Fi(write)h(hazard)f Fr(indicates)g(that)h(the)f(content)g
(of)g(some)g(cache)1992 5209 y(depends)d(on)i(the)g(current)f(v)n(alue)
h(of)g(the)g(k)o(e)o(y)g(occup)o(ying)e(a)i(slot,)1992
5309 y(and)17 b(the)h(cache)f(must)h(be)g(\003ushed)f(before)f(a)j
(slot)f(write)g(can)g(safe-)1992 5408 y(ly)27 b(proceed.)43
b(Write)28 b(hazards)e(arise)h(in)g(se)o(gment)f(trees,)j(where)p
eop
%%Page: 6 7
6 6 bop 0 -199 a Fh(4)83 b(REALIZING)19 b(THE)h(MA)m(CHINE)2703
b Fr(6)0 91 y(mapping)28 b(entries)h(may)h(need)f(to)g(be)h(in)m(v)n
(alidated,)g(and)f(in)h(do-)0 191 y(mains,)19 b(where)e(writing)h(a)h
(slot)g(may)g(require)e(updating)f(the)j(con-)0 291 y(te)o(xt)h(cache)g
(structure)f(associated)h(with)g(the)h(domain.)0 423
y(A)30 b Fi(r)o(ead)e(hazard)h Fr(indicates)g(that)h(the)f(current)f
(content)g(of)h(the)0 523 y(slot)22 b(is)f(not)g(up)g(to)g(date,)g(and)
f(must)h(be)g(\003ushed)f(back)h(to)g(the)g(k)o(e)o(y)0
623 y(from)i(a)i(cache.)37 b(Read)25 b(hazards)f(arise)g(in)h(domains,)
f(where)g(up-)0 722 y(to-date)c(re)o(gister)g(v)n(alues)h(may)f(need)g
(to)i(be)e(\003ushed)h(back)f(to)h(the)0 822 y(domain)f(from)h(the)g
(conte)o(xt)f(cache.)29 b(All)22 b(read)f(hazards)f(are)i(also)0
922 y(write)e(hazards.)0 1054 y(On)g(multiprocessors,)f(both)h(read)f
(and)h(write)h(hazards)e(may)h(im-)0 1154 y(ply)29 b(the)g(need)g(for)g
(interprocessor)e(signalling)h(to)i(arrange)e(for)0 1254
y(translation)19 b(caches)h(and/or)f(re)o(gister)h(sets)h(to)f(be)g
(\003ushed.)0 1809 y Fg(4.2)99 b(The)26 b(Context)g(Cache)0
2054 y Fr(While)48 b(number)e(k)o(e)o(ys)i(pro)o(vide)e(a)i(space-ef)n
(\002cient)f(storage)0 2154 y(medium)21 b(for)h(re)o(gister)g(v)n
(alues,)h(the)o(y)f(are)g(not)h(an)f(especially)g(ef-)0
2253 y(\002cient)33 b(format)e(for)h(loading)f(and)h(sa)n(ving)h(re)o
(gisters)f(during)f(a)0 2353 y(conte)o(xt)15 b(switch.)24
b(F)o(or)17 b(this)g(reason,)f(the)h(re)o(gister)f(v)n(alues)g(of)h(a)g
(do-)0 2453 y(main)i(are)h(loaded)f(into)g(a)i(machine-speci\002c)c
Fi(context)i Fr(structure)0 2552 y(before)29 b(the)i(domain)e(conte)o
(xt)g(is)i(loaded)f(onto)f(the)i(hardw)o(are.)0 2652
y(The)d(domain)e(layout)i(is)h(chosen)e(for)g(the)h(con)m(v)o(enience)d
(of)j(the)0 2752 y(abstract)17 b(machine.)22 b(Because)17
b(cross-domain)e(message)h(passing)0 2851 y(and)k(conte)o(xt)f
(switching)h(performance)e(is)j(critical,)f(the)h(conte)o(x-)0
2951 y(t)32 b(structure)e(layout)g(is)i(chosen)f(for)f(ef)n(\002cient)h
(conte)o(xt)f(switch.)0 3050 y(A)c(number)f(of)g(implementation)f
(tricks)i(are)g(used)g(to)g(f)o(acilitate)0 3150 y(rapid)19
b(conte)o(xt)g(structure)h(sa)n(v)o(e)g(and)g(restore.)0
3283 y(In)47 b(con)m(v)o(entional)d(operating)h(systems,)54
b(processor)45 b(state)j(is)0 3383 y(sa)n(v)o(ed)23 b(to)h(an)f
(interrupt)f(stack,)j(and)e(later)g(transferred)f(to)i(a)f(per)n(-)0
3482 y(process)32 b(structure.)60 b(In)32 b(ER)m(OS,)h(we)f(contri)n(v)
o(e)f(for)g(the)i(initial)0 3582 y(interrupt)27 b(stack)j(pointer)d(to)
j(point)e(to)h(the)g(top)g(of)f(the)h(conte)o(xt)0 3681
y(structure)20 b(for)g(the)h(acti)n(v)o(e)f(domain.)26
b(W)-7 b(e)22 b(sa)n(v)o(e)f(the)g(process)f(state)0
3781 y(directly)28 b(into)g(the)h(conte)o(xt)e(structure)g(and)h(then)g
(switch)h(inter)n(-)0 3881 y(rupt)20 b(stacks.)28 b(As)21
b(a)g(result,)g(the)g(domain)f(state)h(is)h(sa)n(v)o(ed)e(into)h(the)0
3980 y(process)k(structure)g(without)g(the)h(need)f(for)g(a)h(later)g
(cop)o(y)-5 b(.)40 b(This)0 4080 y(technique)20 b(is)j(similar)f(to)g
(techniques)f(used)h(in)g(L3)f([Liedtk)o(e93)n(])0 4180
y(and)f(Mach)f(4.0)h([F)o(ord93)m(].)0 4312 y(Because)i(ER)m(OS)g
(programs)d(can)i(hold)g(node)g(k)o(e)o(ys)g(to)g(the)h(com-)0
4412 y(ponents)32 b(of)g(domains,)i(ho)n(we)n(v)o(er)m(,)g(we)f(must)f
(be)h(able)f(to)h(ef)n(\002-)0 4512 y(ciently)g(and)g(selecti)n(v)o
(ely)f(\003ush)i(subsets)g(of)f(a)g(conte)o(xt)g(cache)0
4611 y(entry)23 b(back)h(to)g(the)h(constituent)e(nodes)g(of)h(the)h
(domain)e(on)g(de-)0 4711 y(mand.)h(In)19 b(clearing)g(hazards)g
(associated)g(with)h(k)o(e)o(y)g(slots)g(in)g(the)0 4811
y(domain)k(root,)j(portions)d(of)h(the)h(conte)o(xt)f(cache)g(entry)g
(may)g(be)0 4910 y(unloaded.)e(Before)c(running)f(a)i(process)g(or)f(e)
o(xamining)f(its)j(con-)0 5010 y(te)o(xt)h(structure,)f(the)h(k)o
(ernel)f(must)h(\002rst)h(v)o(erify)d(that)i(the)g(domain)0
5109 y(is)j(fully)e(loaded)g(into)h(the)g(conte)o(xt.)36
b(F)o(or)23 b(ef)n(\002cienc)o(y)g(in)h(conte)o(xt)0
5209 y(switching,)18 b(a)i(simple)f(zero-test)f(of)h(the)g(conte)o(xt)f
(sa)n(v)o(e)h(area)g(\002eld)0 5309 y(is)h(suf)n(\002cient)e(to)g
(determine)g(if)g(the)h(conte)o(xt)e(is)j(fully)e(cached)g(and)0
5408 y(runnable.)1992 91 y Fg(4.3)99 b(Mapping)25 b(T)-9
b(able)25 b(Management)1992 284 y Fr(When)d(a)h(translation)f(f)o(ault)
h(occurs,)f(the)h(program')-5 b(s)21 b(address)h(s-)1992
384 y(pace)30 b(se)o(gment)h(is)h(tra)n(v)o(ersed)e(by)h(the)g(k)o
(ernel)f(to)i(construct)e(an)1992 483 y(appropriate)25
b(mapping)i(table)h(entry)-5 b(.)47 b(In)m(v)n(alid)27
b(of)n(fsets)h(and)g(ac-)1992 583 y(cess)e(rights)g(violations)f(are)h
(encapsulated)e(by)i(the)g(k)o(ernel)f(and)1992 683 y(reported)19
b(to)j(a)g(user)n(-le)n(v)o(el)e(f)o(ault)h(handler)-5
b(.)28 b(The)21 b(hardw)o(are)f(map-)1992 782 y(ping)i(tables,)j(in)f
(ef)n(fect,)f(are)h(a)g(lazily-generated)d(projection)h(of)1992
882 y(the)e(access)h(rights)e(con)m(v)o(e)o(yed)e(by)j(the)g(se)o
(gment.)1992 1015 y(There)f(are)i(three)f(circumstances)g(under)f
(which)h(a)i(mapping)c(ta-)1992 1114 y(ble)i(entry)f(can)h(cease)h(to)f
(be)g(v)n(alid:)2054 1322 y(1.)41 b(The)23 b(content)f(of)h(a)h(page)f
(frame)g(named)f(by)h(the)g(mapping)2158 1422 y(entry)c(can)h(be)g
(remo)o(v)o(ed)e(from)h(memory)-5 b(.)2054 1605 y(2.)41
b(A)18 b(k)o(e)o(y)g(slot)h(tra)n(v)o(ersed)e(in)i(the)f(construction)f
(of)h(a)g(mapping)2158 1705 y(entry)h(can)h(be)g(o)o(v)o(erwritten)e
(with)i(a)h(dif)n(ferent)e(k)o(e)o(y)-5 b(.)2054 1889
y(3.)41 b(A)16 b(node)g(containing)e(a)j(slot)g(tra)n(v)o(ersed)f(in)g
(the)h(construction)2158 1988 y(of)i(a)i(mapping)d(entry)i(can)g(be)g
(remo)o(v)o(ed)e(from)h(memory)-5 b(.)1992 2196 y(Each)22
b(of)i(these)f(cases)h(must)g(be)f(addressed)g(by)g(supporting)e(de-)
1992 2296 y(pendenc)o(y)c(management)h(structures.)1992
2570 y Fi(4.3.1)81 b(The)21 b(P)o(age)e(Dependency)i(Cache)1992
2763 y Fr(P)o(age)f(reclamation)f(is)i(addressed)f(by)g(maintaining)f
(an)i(in)m(v)o(erted)1992 2862 y(page)28 b(table.)50
b(Whene)n(v)o(er)28 b(a)h(page)f(table)h(entry)f(is)h(created)f(that)
1992 2962 y(points)18 b(to)g(a)h(page)f(in)h(the)f(object)g(cache,)h(a)
g(dependenc)o(y)c(entry)j(is)1992 3061 y(added)d(to)j(the)f
Fl(pa)o(g)o(e)f(dependency)e(cac)o(he)p Fr(.)23 b(The)17
b(page)f(dependen-)1992 3161 y(c)o(y)21 b(cache)h(is)h(inde)o(x)o(ed)d
(by)i(a)h(hash)f(on)f(the)h(page)g(frame)f(address.)1992
3261 y(A)30 b(three-sided)e(data)h(structure)g(is)h(constructed,)g(as)h
(sho)n(wn)d(in)1992 3360 y(Figure)20 b(5.)28 b(When)21
b(the)g(page)f(frame)h(is)h(reclaimed,)e(all)h(mapping)1992
3460 y(entries)28 b(naming)f(that)i(page)f(frame)g(are)g(located)g(via)
h(the)f(page)1992 3560 y(dependenc)o(y)23 b(cache)k(and)g(in)m(v)n
(alidated.)44 b(Before)26 b(an)o(y)h(page)f(de-)1992
3659 y(pendenc)o(y)20 b(cache)j(entry)g(is)h(\003ushed,)g(the)f
(corresponding)d(map-)1992 3759 y(ping)f(entry)g(is)i(in)m(v)n
(alidated.)2375 3885 y
 9012101 7235993 0 0 9012101 7235993 startTexFig
 2375 3885 a
%%BeginDocument: PageDepend.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: PageDepend.fig
%%Creator: fig2dev Version 3.2 Patchlevel 1
%%CreationDate: Wed Oct 13 21:20:36 1999
%%For: shapj@bonzo.watson.ibm.com (Jonathan Shapiro)
%%Orientation: Portrait
%%BoundingBox: 0 0 137 110
%%Pages: 0
%%BeginSetup
%%EndSetup
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-13.0 116.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def
%%EndProlog

$F2psBegin
10 setmiterlimit
n -1000 2920 m -1000 -1000 l 3487 -1000 l 3487 2920 l cp clip
 0.06000 0.06000 sc
% Polyline
7.500 slw
n 451 751 m 1351 751 l 1351 1651 l 451 1651 l cp gs col-1 s gr 
% Polyline
n 451 976 m 1351 976 l 1351 1126 l 451 1126 l cp gs col-1 s gr 
% Polyline
n 300 300 m 1125 300 l 1125 450 l 300 450 l cp gs col-1 s gr 
% Polyline
n 1800 300 m 2475 300 l 2475 900 l 1800 900 l cp gs col-1 s gr 
% Polyline
gs  clippath
270 570 m 300 450 l 330 570 l 330 435 l 270 435 l cp
clip
n 900 1050 m 300 1050 l 300 450 l gs col-1 s gr gr

% arrowhead
n 270 570 m 300 450 l 330 570 l 300 570 l 270 570 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
1680 345 m 1800 375 l 1680 405 l 1815 405 l 1815 345 l cp
clip
n 900 375 m 1800 375 l gs col-1 s gr gr

% arrowhead
n 1680 345 m 1800 375 l 1680 405 l 1680 375 l 1680 345 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
gs  clippath
1470 1080 m 1350 1050 l 1470 1020 l 1335 1020 l 1335 1080 l cp
clip
n 2025 900 m 2025 1050 l 1350 1050 l gs col-1 s gr gr

% arrowhead
n 1470 1080 m 1350 1050 l 1470 1020 l 1470 1050 l 1470 1080 l  cp gs 0.00 setgray ef gr  col-1 s
/Times-BoldItalic ff 150.00 scf sf
300 225 m
gs 1 -1 sc (Mapping Entry) col-1 sh gr
/Times-BoldItalic ff 150.00 scf sf
225 1875 m
gs 1 -1 sc (Page Dependency Cache) col-1 sh gr
/Times-BoldItalic ff 150.00 scf sf
1950 225 m
gs 1 -1 sc (Page) col-1 sh gr
$F2psEnd
rs

%%EndDocument

 endTexFig
 2338 4984 a Fr(Figure)f(5:)25 b(P)o(age)20 b(dependenc)o(y)d
(structure)1992 5309 y(As)j(with)h(the)f(object)f(table,)h(no)g
(attempt)g(is)h(made)e(to)i(update)e(the)1992 5408 y(page)c(dependenc)o
(y)d(cache)j(when)g(a)h(mapping)e(page)h(is)i(discarded)p
eop
%%Page: 7 8
7 7 bop 0 -199 a Fh(5)83 b(THE)20 b(CHECKPOINT)g(MECHANISM)2497
b Fr(7)0 91 y(by)21 b(the)h(ager)-5 b(.)30 b(It)22 b(is)h(the)f
(responsibility)f(of)g(the)h(mapping)e(in)m(v)n(ali-)0
191 y(dation)15 b(logic)g(to)h(v)o(erify)f(that)h(the)g(mapping)e
(entry)h(pointer)g(points)0 291 y(to)28 b(a)g(v)n(alid)f(mapping)e
(entry)i(that)g(should)g(be)g(in)m(v)n(alidated.)45 b(On)0
390 y(architectures)26 b(using)h(hash)f(structured)g(or)h(softw)o
(are-managed)0 490 y(mapping)i(structures,)k(this)f(is)g(not)e(dif)n
(\002cult;)36 b(mapping)29 b(struc-)0 589 y(tures)h(on)f(these)h
(machines)f(are)h(tak)o(en)f(from)g(a)i(reserv)o(ed)d(pool)0
689 y(of)g(memory)-5 b(.)45 b(On)28 b(machines)f(using)h(page-sized)e
(mapping)g(ta-)0 789 y(bles,)i(mapping)d(page)h(frames)g(are)h
(allocated)e(out)i(of)f(the)h(page)0 888 y(frame)j(cache.)55
b(Before)30 b(in)m(v)n(alidating)e(the)i(mapping)f(entry)g(on)0
988 y(such)18 b(machines,)g(the)g(dependenc)o(y)d(cache)j(must)h(v)o
(erify)e(that)h(the)0 1088 y(mapping)e(page)g(frame)h(has)h(not)f(been)
g(reclaimed)f(for)h(other)g(pur)n(-)0 1187 y(poses.)0
1320 y(Note)37 b(that)g(the)g(hardw)o(are)e(mapping)h(table)g
(structures)h(are)g(a)0 1420 y(cache)27 b(of)g(the)g(state)h(captured)e
(by)h(a)h(se)o(gment)e(tree.)47 b(Mapping)0 1519 y(tables)19
b(can)g(al)o(w)o(ays)h(be)f(discarded)e(completely)h(with)h(no)g(loss)g
(of)0 1619 y(information.)29 b(If)22 b(this)g(is)i(done,)d(the)o(y)h
(will)g(be)h(reb)n(uilt)f(as)g(neces-)0 1719 y(sary)-5
b(.)0 1979 y Fi(4.3.2)81 b(The)21 b(Slot)f(Dependency)h(Cache)0
2169 y Fr(Node)28 b(remo)o(v)n(al,)h(surprisingly)e(enough,)h(is)i
(more)e(straightfor)n(-)0 2268 y(w)o(ard.)35 b(All)25
b(of)e(the)h(se)o(gment-related)d(dependencies)h(in)i(a)g(node)0
2368 y(are)19 b(co)o(v)o(ered)e(by)i(the)g(dependencies)e(on)h(the)i
(node')-5 b(s)18 b(slots.)25 b(If)19 b(all)0 2468 y(of)g(the)h(k)o(e)o
(y)f(slot)h(dependencies)d(for)i(the)h(slots)g(in)g(the)f(node)g(ha)n
(v)o(e)0 2567 y(been)28 b(in)m(v)n(alidated,)g(the)h(node)e(can)i
(safely)f(be)g(remo)o(v)o(ed.)48 b(This)0 2667 y(reduces)27
b(the)g(problem)f(to)i(the)g(tracking)e(and)h(management)e(of)0
2766 y(k)o(e)o(y)20 b(slot)g(dependencies.)0 2899 y(T)-7
b(o)27 b(understand)e(ho)n(w)h(k)o(e)o(y)g(slot)i(dependencies)c(are)j
(track)o(ed,)g(it)0 2999 y(is)f(useful)e(to)h(see)g(ho)n(w)f(the)o(y)g
(are)h(constructed)e(by)h(the)h(se)o(gment)0 3099 y(tra)n(v)o(ersal)f
(algorithm.)38 b(A)26 b(simpli\002ed)e(v)o(ersion)g(of)h(the)g(tra)n(v)
o(ersal)0 3198 y(algorithm)17 b(is)i(sho)n(wn)f(in)h(Figure)f(6.)24
b(The)18 b(crucial)g(line)h(is)g(the)g(call)0 3298 y(to)h
Fb(Depend::AddKey\(\))p Fr(.)j(This)d(b)n(uilds)g(an)g(in)m(v)o(erse)e
(projec-)0 3397 y(tion)24 b(from)g(the)g(mapping)f(table)h(entries)h
(back)e(to)i(the)f(k)o(e)o(y)g(slots)0 3497 y(that)k(generated)f(them,)
i(allo)n(wing)f(the)g(dependenc)o(y)d(entries)j(to)0
3597 y(be)f(found)e(and)h(in)m(v)n(alidated)f(when)i(the)f(slot)i(is)g
(o)o(v)o(erwritten)c(or)0 3696 y(its)d(containing)d(node)i(is)h(remo)o
(v)o(ed.)0 3829 y(As)29 b(each)e(slot)h(is)h(tra)n(v)o(ersed)e(on)g
(the)h(path)f(to)h(constructing)e(the)0 3929 y(mapping)c(entry)-5
b(,)24 b(the)g(tra)n(v)o(ersed)f(slot)i(is)g(mark)o(ed)e(as)h(write)h
(haz-)0 4028 y(arded.)46 b(T)-7 b(o)27 b(clear)h(the)f(write)h(hazard,)
g(the)f(associated)g(slot)h(de-)0 4128 y(pendenc)o(y)18
b(cache)h(entries)h(must)h(be)f(in)m(v)n(alidated.)0
4388 y Fi(4.3.3)81 b(Mer)o(ging)20 b(Related)g(Entries)0
4578 y Fr(A)i(typical)g(slot)g(in)g(a)g(se)o(gment)f(tree)h(is)h(in)m
(v)n(olv)o(ed)d(in)i(the)g(genera-)0 4678 y(tion)f(of)h(multiple)f
(mapping)f(entries.)29 b(On)22 b(machines)f(with)g(tree-)0
4777 y(structured)g(hardw)o(are)h(mapping)f(tables,)i(these)g(entries)g
(tend)f(to)0 4877 y(be)h(contiguous)f(within)h(a)h(common)e(mapping)g
(page.)34 b(On)23 b(such)0 4977 y(machines,)38 b(the)e(slot)g
(dependenc)o(y)c(cache)j(will)i(coalesce)e(the)0 5076
y(shado)n(wed)16 b(mapping)g(entries)h(into)g(a)h(common)e(cache)h
(entry)f(de-)0 5176 y(scribing)j(a)i(set)g(of)f(adjacent)f(mapping)f
(entries.)0 5309 y(This)25 b(optimization)f(pro)o(v)o(es)g(to)h(be)g
(an)g(important)f(source)h(of)g(s-)0 5408 y(pace)31 b(ef)n(\002cienc)o
(y)-5 b(.)57 b(An)31 b(open)f(issue)i(in)g(the)f(current)f(design)h(is)
1992 91 y(ho)n(w)23 b(to)i(accomplish)e(similar)h(ef)n(\002ciencies)g
(on)g(machines)f(with)1992 191 y(hashed)c(mapping)f(tables)j(or)f
(softw)o(are-based)e(miss)j(handlers.)1992 508 y Fm(5)119
b(The)30 b(Checkpoint)i(Mechanism)1992 727 y Fr(ER)m(OS)17
b(implements)g(persistence)f(and)h(e)o(xogenous)e(f)o(ault)i(reco)o(v-)
1992 827 y(ery)k(using)g(the)h(same)g(mechanism:)27 b(a)c(reco)o(v)o
(erable)c(checkpoint)1992 926 y(using)30 b(a)h(circular)f(checkpoint)f
(log.)56 b(The)31 b(checkpoint)e(mech-)1992 1026 y(anism)e(is)h
(similar)g(to)f(that)h(of)f(K)n(e)o(yK)n(OS)f([Landau92)m(],)j(b)n(ut)f
(the)1992 1126 y(use)d(of)h(a)g(circular)f(log)g(mak)o(es)h(it)g(more)f
(adaptable)g(to)h(runtime)1992 1225 y(load)19 b(v)n(ariations.)1992
1358 y(Before)26 b(an)o(y)g(object)g(may)g(be)h(modi\002ed)f(in)h
(memory)-5 b(,)26 b(space)h(is)1992 1458 y(reserv)o(ed)f(for)h(it)h(in)
g(the)g(log.)47 b(When)27 b(the)h(dirty)f(object)g(is)h(later)1992
1557 y(written)19 b(to)g(the)h(disk,)f(it)h(is)g(appended)d(to)j(the)f
(log.)25 b(Object)19 b(cache)1992 1657 y(misses)25 b(are)f(satis\002ed)
i(from)d(the)i(log)f(if)h(the)f(object)g(is)i(found)c(in)1992
1757 y(the)g(checkpoint)f(log)h(catalog,)g(or)g(from)g(the)h(object')-5
b(s)22 b(home)g(lo-)1992 1856 y(cation)d(if)i(it)g(is)g(not)f(\(Figure)
f(7\).)1992 1989 y(Periodically)-5 b(,)26 b(or)g(when)g(the)g(a)n(v)n
(ailable)g(checkpoint)e(log)j(space)1992 2089 y(reaches)34
b(a)h(lo)n(w)g(w)o(atermark,)i(the)e(k)o(ernel)f(declares)g(a)i(check-)
1992 2188 y(point.)22 b(When)17 b(a)f(checkpoint)f(is)i(declared,)f
(the)g(system)h(is)g(frozen)1992 2288 y(and)g(all)h(dirty)f(objects)h
(are)g(\003ushed)f(to)h(the)g(log.)24 b(The)17 b(current)g(log)1992
2388 y(catalog)27 b(is)i(then)e(\003ushed)h(to)g(the)g(log)f(along)g
(with)h(the)g(curren-)1992 2487 y(t)g(thread)f(list,)j(and)d(the)h
(checkpoint)e(log)h(header)g(is)h(re)n(vised)f(to)1992
2587 y(gi)n(v)o(e)21 b(the)i(location)e(of)i(the)f(most)h(recently)e
(committed)g(catalog.)1992 2686 y(At)27 b(this)g(point)f(the)h
(checkpoint)e(has)i(completed)e(successfully)-5 b(,)1992
2786 y(and)21 b(a)i(migrator)e(is)j(started)e(to)h(cop)o(y)f(the)g
(objects)g(back)g(to)h(their)1992 2886 y(home)18 b(locations.)24
b(When)c(the)g(migrator)e(has)i(completed)e(its)j(mi-)1992
2985 y(gration,)28 b(it)h(updates)f(the)g(checkpoint)e(log)i(header)f
(to)h(indicate)1992 3085 y(that)h(space)h(in)g(the)g(log)g(pre)n
(viously)d(occupied)h(by)i(the)g(check-)1992 3185 y(pointed)18
b(state)j(is)g(no)n(w)e(free.)25 b(The)20 b(net)g(ef)n(fect)f(is)i
(that)f(the)g(system)1992 3284 y(is)j(al)o(w)o(ays)g(able)f(to)g(reco)o
(v)o(er)f(from)g(the)i(most)f(recent)g(successful)1992
3384 y(checkpoint.)1992 3517 y(While)42 b(conceptually)d(accurate,)46
b(the)c(algorithm)e(just)i(gi)n(v)o(en)1992 3616 y(w)o(ould)23
b(be)h(intolerably)f(slo)n(w)h(in)h(practice.)36 b(Flushing)24
b(the)g(dirty)1992 3716 y(objects)g(tak)o(es)i(a)g(signi\002cant)e
(amount)g(of)h(time,)h(and)f(delays)g(as)1992 3816 y(short)15
b(as)i(100)e(ms)h(are)g(noticable)f(to)h(users)g(in)g(the)g(form)f(of)g
(mouse)1992 3915 y(jitter)36 b(and)g(character)f(echo)h(stalls.)74
b(T)-7 b(o)37 b(a)n(v)n(oid)f(long)f(delays,)1992 4015
y(checkpoint)18 b(is)j(performed)c(in)k(three)e(phases.)1992
4289 y Fg(5.1)99 b(Fr)n(eezing)25 b(the)h(Image)1992
4478 y Fr(The)c(\002rst)h(phase)f(of)g(the)g(checkpoint)f(is)i(to)g
(freeze)e(all)j(dirty)d(ob-)1992 4578 y(jects)26 b(in)g(memory)-5
b(,)25 b(ensuring)f(that)i(the)o(y)f(will)i(not)e(be)h(modi\002ed)1992
4678 y(until)18 b(the)i(checkpoint)d(has)i(completed.)k(Objects)c(are)g
(frozen)f(by)1992 4777 y(marking)23 b(them)i(as)h(write)g(hazarded,)f
(and)g(disabling)f(the)h(write)1992 4877 y(permission)d(bits)h(on)g
(all)h(page)f(table)g(entries.)34 b(Finally)-5 b(,)23
b(all)h(user)1992 4977 y(threads)e(are)i(deprepared,)e(and)h(a)h
(frozen)e(cop)o(y)h(is)h(made)f(of)h(the)1992 5076 y(in-core)18
b(thread)h(list.)26 b(Ex)o(ecution)18 b(is)j(no)n(w)e(permitted)f(to)i
(resume.)1992 5176 y(As)27 b(each)g(mutating)f(reference)g(is)i
(performed,)e(the)h(associated)1992 5275 y(objects)19
b(are)i(duplicated)d(using)i(a)g(cop)o(y-on-write)e(mechanism.)1992
5408 y(As)f(with)g(k)o(e)o(y)g(slots,)h(hazards)e(are)h(set)g(on)g(an)g
(object)f(frame)g(when)p eop
%%Page: 8 9
8 8 bop 0 -199 a Fh(6)83 b(CONCLUSIONS)3152 b Fr(8)0
91 y(that)27 b(frame)g(is)h(in)m(v)n(olv)o(ed)d(in)i(I/O.)g(During)f
(inbound)f(I/O,)j(there)0 191 y(is)e(a)g(brief)f(windo)n(w)f(of)h(time)
h(during)e(which)h(the)g(object)g(frame)0 291 y(e)o(xists)c(b)n(ut)f
(the)g(inbound)e(data)i(transfer)f(is)i(incomplete.)i(During)0
390 y(this)29 b(windo)n(w)-5 b(,)29 b(the)g(object)f(is)h(read)f
(hazarded.)48 b(Similarly)-5 b(,)30 b(the)0 490 y(object)22
b(is)h(write)f(hazarded)e(during)h(on)g(outbound)f(I/O.)i(Objects)0
589 y(hazarded)d(by)i(I/O)g(ha)n(v)o(e)f(a)h(non-zero)e(I/O)i(count)f
(in)h(their)g(object)0 689 y(header)-5 b(.)0 822 y(The)27
b(100)f(ms)h(tar)o(get)f(allo)n(ws)i(us)f(to)g(freeze)f(up)h(to)g(half)
g(a)g(giga-)0 922 y(byte)e(of)g(main)g(memory)f(with)h(no)g(noticeable)
f(delay)-5 b(,)26 b(and)e(per)n(-)0 1021 y(haps)h(128)g(times)h(that)f
(much)g(by)g(rearranging)e(the)i(hazard)g(bits)0 1121
y(to)e(f)o(a)n(v)n(or)g(cache)g(locality)-5 b(.)33 b(Ultimately)-5
b(,)23 b(hierarchical)f(or)h(w)o(ater)n(-)0 1220 y(marking)14
b(techniques)h(can)h(be)g(used)g(to)g(scale)g(this)h(phase)e(further)-5
b(.)0 1525 y Fg(5.2)99 b(Writing)25 b(the)g(Dirty)g(Objects)0
1720 y Fr(Once)39 b(the)f(mark)g(phase)h(has)g(completed,)j(the)d
(object)f(write)0 1820 y(phase)32 b(can)h(proceed)e(at)i(lo)n(w)g
(priority)-5 b(.)60 b(Objects)33 b(mark)o(ed)f(for)0
1920 y(checkpoint)i(are)i(incrementally)f(written)h(to)g(the)g
(checkpoint)0 2019 y(log,)26 b(at)f(a)h(pace)e(suf)n(\002cient)h(to)g
(complete)f(the)h(process)g(well)g(be-)0 2119 y(fore)32
b(the)g(ne)o(xt)g(checkpoint)e(occurs.)61 b(No)33 b(special)f(support)f
(is)0 2218 y(needed)h(to)i(cause)g(this)g(to)g(happen.)64
b(The)33 b(cleaning)g(daemon)0 2318 y(simply)e(pages)f(the)h(objects)g
(out,)i(decrementing)28 b(the)j(number)0 2418 y(of)c(pending)e
(checkpoint)g(I/O')-5 b(s)28 b(as)g(it)g(goes)f(along.)45
b(When)27 b(the)0 2517 y(count)g(reaches)h(zero,)h(it)g(has)f
(successfully)g(written)g(all)g(of)g(the)0 2617 y(checkpoint)18
b(state.)0 2750 y(When)32 b(all)g(of)g(the)g(dirty)f(objects)h(ha)n(v)o
(e)f(been)g(paged)g(out,)j(the)0 2849 y(thread)28 b(list)i(and)f(the)g
(checkpoint)e(catalog)h(are)h(written)g(out)g(to)0 2949
y(the)21 b(checkpoint)e(log.)27 b(While)22 b(space)f(for)f(the)h
(objects)g(in)g(the)g(log)0 3049 y(is)30 b(prereserv)o(ed,)e(the)h
(placement)e(of)i(an)o(y)e(gi)n(v)o(en)h(object)g(in)h(the)0
3148 y(log)20 b(is)i(not)f(kno)n(wn)e(until)h(the)h(page)f(daemon)g
(forces)g(that)h(object)0 3248 y(to)f(the)f(disk.)25
b(Writing)19 b(the)h(catalog)f(must)g(therefore)f(be)h(delayed)0
3348 y(until)h(all)h(objects)f(ha)n(v)o(e)f(been)h(written.)0
3480 y(Finally)-5 b(,)18 b(the)h(checkpoint)d(log)j(header)e(is)j
(updated)d(to)h(re\003ect)h(the)0 3580 y(location)30
b(of)g(the)g(catalog)g(associated)g(with)h(the)f(most)h(recent-)0
3680 y(ly)25 b(completed)f(checkpoint.)38 b(T)-7 b(o)26
b(guard)e(against)g(write)i(f)o(ailure,)0 3779 y(the)j(checkpoint)e
(log)h(header)g(is)i(written)e(sequentially)g(to)h(tw)o(o)0
3879 y(dif)n(ferent)f(sectors.)53 b(This)30 b(ensures)f(that)h(one)f
(cop)o(y)f(of)i(the)f(log)0 3979 y(header)19 b(al)o(w)o(ays)i(has)f(v)n
(alid)g(data.)0 4283 y Fg(5.3)99 b(Migration)0 4478 y
Fr(Once)23 b(a)h(checkpoint)e(image)h(has)h(been)e(completely)h
(written)g(to)0 4578 y(the)j(checkpoint)e(log,)j(a)g(migration)d(phase)
i(must)g(be)g(started)g(to)0 4678 y(free)32 b(space)f(in)i(the)e(log)h
(for)f(the)h(ne)o(xt)g(checkpoint.)58 b(The)31 b(mi-)0
4777 y(grator)g(e)o(xamines)h(the)h(checkpoint)d(catalog)i(\(which)g
(remains)0 4877 y(in)27 b(memory\))d(to)j(determine)e(an)h(ef)n
(\002cient)g(order)f(of)h(operation,)0 4977 y(and)j(copies)h(the)g
(objects)f(from)g(the)h(log)f(to)h(their)g(home)f(loca-)0
5076 y(tion.)c(In)19 b(practice,)g(man)o(y)g(of)h(the)g(objects)g(that)
g(need)f(to)h(go)g(back)0 5176 y(to)27 b(home)g(locations)f(are)h
(still)h(in)g(memory)-5 b(,)26 b(and)h(these)g(objects)0
5275 y(do)20 b(not)g(need)f(to)h(be)h(read)e(back)h(in)g(from)f(the)h
(log.)0 5408 y(One)i(adv)n(antage)d(to)j(the)g(circular)f(log)g
(structure)g(is)i(that)e(the)h(mi-)1992 91 y(grator)16
b(can)h(proceed)e(incrementally)h([Gray93)m(].)24 b(If)17
b(there)g(is)h(sig-)1992 191 y(ni\002cant)e(pressure)f(on)h(the)g(log,)
h(the)f(migrator)f(can)h(mo)o(v)o(e)f(a)i(small)1992
291 y(number)27 b(of)i(objects,)h(write)g(a)f(ne)n(w)g(checkpoint)e
(catalog,)j(and)1992 390 y(update)19 b(the)h(checkpoint)e(log)h(header)
g(to)i(re\003ect)f(the)g(ne)n(w)g(\223most)1992 490 y(recent)f
(checkpoint\224)f(catalog.)1992 821 y Fm(6)119 b(Conclusions)1992
1043 y Fr(The)23 b(ER)m(OS)i(system)g(is)g(currently)e(running)f(on)i
(i486)f(and)h(Pen-)1992 1143 y(tium)31 b(class)i(hardw)o(are.)59
b(The)32 b(implementation)e(requires)g(less)1992 1242
y(than)35 b(64)g(Kilobytes)g(of)g(supervisor)f(code,)39
b(made)c(up)g(of)g(ap-)1992 1342 y(proximately)27 b(18,000)h(lines)j
(of)e(C++)i(source)e(and)h(1400)e(lines)1992 1442 y(of)38
b(assembly)g(code.)80 b(The)38 b(C++)i(code)e(is)h(e)n(v)o(enly)f
(split)h(be-)1992 1541 y(tween)16 b(machine)f(dependent)g(and)h
(machine)f(independent)f(code.)1992 1641 y(Our)47 b(intention)f(is)i
(to)g(mak)o(e)f(the)h(implementation)d(widely)1992 1741
y(a)n(v)n(ailable)d(when)g(completed.)90 b(T)-7 b(o)43
b(be)f(placed)g(on)g(the)h(an-)1992 1840 y(nouncement)36
b(list,)44 b(please)38 b(visit)i(the)e(ER)m(OS)h(home)f(page)g(at)1992
1940 y Fb(http://www.cis.upenn.edu/\230eros)1992 2073
y Fr(W)-7 b(e)26 b(will)h(shortly)e(be)h(turning)e(our)h
(implementation)e(ef)n(forts)i(to)1992 2172 y(the)20
b(distrib)n(uted)f(v)o(ersion)g(of)h(the)g(system.)1992
2461 y Fg(6.1)99 b(Lessons)25 b(Lear)o(ned)1992 2653
y Fr(The)15 b(design)h(described)f(here)g(re\003ects)i(kno)n(wledge)d
(gained)h(from)1992 2753 y(se)n(v)o(eral)34 b(f)o(alse)i(starts,)j(and)
c(se)n(v)o(eral)f(departures)g(from)g(earlier)1992 2852
y(w)o(ork.)1992 3124 y Fi(Thr)o(eads)1992 3317 y Fr(The)23
b(K)n(e)o(yK)n(OS)g(system)h([Hardy85)m(])g(had)g(no)f(\002rst-class)i
(notion)1992 3416 y(of)20 b(a)i(thread,)e(and)g(nothing)g(described)f
(in)j(this)f(paper)f(moti)n(v)n(ates)1992 3516 y(their)25
b(inclusion)g(in)h(the)g(abstract)f(machine.)41 b(Threads)25
b(were)h(o-)1992 3616 y(riginally)k(introduced)f(in)j(the)f(ER)m(OS)h
(k)o(ernel)f(to)h(support)e(pri-)1992 3715 y(oritized)e(scheduling)f
(of)i(dri)n(v)o(ers,)h(and)e(to)i(pro)o(vide)d(a)i(locus)g(at)1992
3815 y(which)g(scheduling)g(polic)o(y)g(might)h(be)g(attached)f
(independent)1992 3915 y(of)24 b(the)g(domain)f(for)g(research)h
(purposes.)36 b(Schedulable)22 b(k)o(ernel)1992 4014
y(dri)n(v)o(ers)h(are)h(pro)o(ving)e(to)j(be)f(a)h(signi\002cant)f(and)
f(useful)h(f)o(acility)-5 b(,)1992 4114 y(b)n(ut)30 b(it)h(is)h(not)e
(clear)g(that)h(the)o(y)f(w)o(arrant)g(the)g(o)o(v)o(erhead)e(of)j(the)
1992 4213 y(thread)19 b(abstraction.)1992 4346 y(Once)30
b(threads)g(were)h(included)e(in)j(the)e(architecture,)i(ho)n(we)n(v-)
1992 4446 y(er)m(,)22 b(the)o(y)h(pro)o(vided)d(a)j(natural)f(w)o(ay)h
(of)f(specifying)g(what)g(host)h(a)1992 4545 y(domain)i(should)h
(compute)f(on)h(in)h(a)h(cluster)-5 b(.)45 b(The)26 b(rule)h(is)g(that)
1992 4645 y(objects)c(migrate)g(to)h(the)g(requesting)f(thread.)35
b(F)o(or)23 b(this)i(reason,)1992 4745 y(the)o(y)19 b(ha)n(v)o(e)h
(been)f(retained.)1992 5017 y Fi(Capability)g(Encryption)1992
5209 y Fr(A)31 b(number)e(of)h(prior)g(capability)g(systems)h(ha)n(v)o
(e)g(adopted)e(en-)1992 5309 y(cryption)21 b(as)k(the)f(mechanism)e
(for)h(capability)g(protection.)33 b(En-)1992 5408 y(crypted)25
b(capabilities)h(allo)n(w)h(the)g(capability)f(tok)o(ens)g(to)h(reside)
p eop
%%Page: 9 10
9 9 bop 0 -199 a Fh(REFERENCES)3337 b Fr(9)0 91 y(within)32
b(the)h(user)g(address)f(space,)j(eliminating)d(the)h(need)f(for)0
191 y(direct)25 b(k)o(ernel)g(management.)40 b(F)o(or)25
b(se)n(v)o(eral)g(reasons,)i(we)f(ha)n(v)o(e)0 291 y(chosen)19
b(not)h(to)h(use)f(this)h(mechanism.)0 423 y(Encrypted)13
b(capabilities)j(rely)f(in)g(part)h(on)f(the)g(ephemeral)f(nature)0
523 y(of)26 b(the)g(holder)f(to)h(defeat)g(for)o(gery)d(attacks.)43
b(In)26 b(most)g(encrypt-)0 623 y(ed)c(capability)f(systems)h(this)g
(issue)h(is)f(ignored.)29 b(In)21 b(a)h(fe)n(w)-5 b(,)22
b(time)0 722 y(stamps)28 b(are)g(used)f(to)h(ensure)f(that)h
(capabilities)g(are)g(ephemer)n(-)0 822 y(al.)64 b(The)32
b(ER)m(OS)i(system)f(is)h(persistent,)i(which)c(violates)h(the)0
922 y(ephemerality)d(assumption.)58 b(Perhaps)32 b(more)f(important,)h
(en-)0 1021 y(crypted)i(capabilities)h(w)o(ould)f(not)h(lend)g
(themselv)o(es)f(well)i(to)0 1121 y(the)31 b(construction)e(of)h(se)o
(gments)g(and)g(domains)g(out)h(of)f(\002x)o(ed-)0 1220
y(size)16 b(fundamental)e(objects,)i(nor)f(to)g(the)h(maintainance)e
(of)i(cache)0 1320 y(consistenc)o(y)j(via)h(hazard)f(tracking.)0
1587 y Fi(Node)h(Size)0 1778 y Fr(A)i(crucial)f(part)g(of)g(ER)m(OS')-5
b(s)22 b(simplicity)f(and)g(small)h(size)g(is)g(that)0
1878 y(the)17 b(k)o(ernel)f(synthesizes)g(all)i(of)e(the)h(abstract)f
(machine')-5 b(s)16 b(objects)0 1978 y(out)23 b(of)h(tw)o(o)f
(fundamental)f(object)h(types.)35 b(This)24 b(eliminates)f(the)0
2077 y(need)k(for)h(the)g(k)o(ernel)f(to)h(do)g(dynamic)e(storage)h
(management,)0 2177 y(which)j(impro)o(v)o(es)e(both)i(its)h
(performance)d(and)i(its)h(reliability)-5 b(.)0 2277
y(Objects)21 b(on)g(the)f(disk)h(are)g(of)g(only)f(tw)o(o)h(types,)f
(which)h(substan-)0 2376 y(tially)k(simpli\002es)h(the)f
(implementation)e(of)i(the)g(single)g(le)n(v)o(el)g(s-)0
2476 y(tore.)0 2609 y(At)31 b(the)f(suggestion)e(of)i(Bryan)g(F)o(ord,)
h(we)f(brie\003y)g(considered)0 2708 y(follo)n(wing)23
b(the)i(path)f(of)g(L3)h([Liedtk)o(e93)m(],)h(which)e(captures)g(al-)0
2808 y(l)33 b(system)f(state)h(in)g(objects)f(of)g(the)g(same)h(size.)
61 b(This)33 b(w)o(ould)0 2908 y(increase)c(the)g(node)f(size)i(to)g
(256)e(slots.)53 b(Our)29 b(initial)h(reaction)0 3007
y(w)o(as)g(that)g(this)g(w)o(ould)f(be)g(unduly)f(w)o(asteful,)k(b)n
(ut)d(in)h(thinking)0 3107 y(this)23 b(we)g(may)f(ha)n(v)o(e)g(been)g
(mistak)o(en.)31 b(The)23 b(page-sized)e(node)g(is)0
3206 y(not)29 b(signi\002cantly)f(lar)o(ger)f(than)i(the)g(current)e
(domain)h(of)h(three)0 3306 y(nodes,)19 b(and)h(might)g(well)h(pro)o(v)
o(e)d(better)i(suited)h(to)f(the)h(construc-)0 3406 y(tion)h(of)g
(small)g(se)o(gments,)g(man)o(y)f(of)h(which)g(are)g(o)o(v)o(er)f(16)g
(pages)0 3505 y(and)f(therefore)f(occup)o(y)g(three)h(or)h(four)e(of)i
(the)g(current)e(nodes)h(in)0 3605 y(an)o(y)j(case.)36
b(W)m(ith)25 b(the)e(bene\002t)h(of)f(hindsight,)g(the)h(slight)g(loss)
h(in)0 3705 y(space)20 b(ef)n(\002cienc)o(y)e(might)i(be)g(more)f(than)
g(recouped)f(in)i(simpli\002-)0 3804 y(cations)f(of)g(the)g(dependenc)o
(y)e(management)g(structures)h(and)h(the)0 3904 y(checkpoint)i
(mechanism.)32 b(It)23 b(w)o(ould)f(also)i(allo)n(w)f(the)g(k)o(ernel)f
(to)0 4003 y(respond)17 b(gracefully)g(to)i(dynamic)e(v)n(ariations)h
(in)h(page)f(pressure)0 4103 y(v)o(ersus)i(node)f(pressure.)0
4387 y Fg(6.2)99 b(Ackno)o(wledgements)0 4578 y Fr(In)26
b(pursuing)e(this)j(w)o(ork,)g(we)g(are)f(deeply)f(indebted)g(to)h(the)
h(as-)0 4678 y(sistance)33 b(of)f(f)o(ar)g(more)f(people)h(than)f(can)h
(reasonably)f(be)h(ac-)0 4777 y(kno)n(wledged.)51 b(Bryan)29
b(F)o(ord)g(of)g(the)h(Uni)n(v)o(ersity)f(of)g(Utah)h(has)0
4877 y(acti)n(v)o(ely)24 b(participated)g(in)h(the)g(design)g
(discussions)g(that)g(led)g(to)0 4977 y(this)e(design,)g(as)h(ha)n(v)o
(e)e(Norman)g(Hardy)-5 b(,)22 b(Charles)h(Landau,)f(and)0
5076 y(W)m(illiam)f(Frantz)e(of)h(the)h(K)n(e)o(yK)n(OS)e(group.)0
5209 y(Early)c(readers)f(caught)g(a)i(number)d(of)i(errors)g(\226)g
(some)g(substantial)0 5309 y(\226)29 b(in)h(this)g(paper)-5
b(.)52 b(Thanks)28 b(to)i(Mitchell)f(P)-9 b(.)30 b(Marcus,)h(W)m
(illiam)0 5408 y(Frantz,)g(and)d(Colin)h(McLean)f(for)h(their)f(ef)n
(forts)h(in)g(re)n(vie)n(wing)1992 91 y(under)18 b(se)n(v)o(ere)i(time)
g(pressure.)1992 405 y Fm(Refer)n(ences)1992 623 y Fr([Bomber)o(ger92])
36 b(Allen)50 b(C.)h(Bomber)o(ger)m(,)j(A.)c(Peri)g(Frantz,)2379
723 y(W)m(illiam)56 b(S.)g(Frantz,)64 b(Ann)55 b(C.)i(Hardy)-5
b(,)63 b(Nor)n(-)2379 823 y(man)30 b(Hardy)-5 b(,)32
b(Charles)f(R.)h(Landau,)g(Jonathan)d(S.)2379 922 y(Shapiro.)37
b(\223The)i(K)n(e)o(yK)n(OS)e(NanoK)n(ernel)g(Archi-)2379
1022 y(tecture,)-6 b(\224)38 b Fl(Pr)l(oceedings)33 b(of)i(the)g
(USENIX)f(W)-8 b(ork-)2379 1122 y(shop)50 b(on)h(Micr)l(o-K)m(ernels)h
(and)e(Other)h(K)m(ernel)2379 1221 y(Ar)m(c)o(hitectur)m(es)p
Fr(.)k(USENIX)g(Association.)g(April)2379 1321 y(1992.)18
b(pp)i(95-112.)1992 1487 y([F)o(ord93])90 b(Bryan)17
b(F)o(ord)g(and)g(Jay)h(Lepreau,)f(\223Ev)n(olving)f(Mach)2379
1587 y(3.0)23 b(to)h(a)g(Migrating)f(Threads)g(Model,)-6
b(\224)23 b Fl(Pr)l(oceed-)2379 1686 y(ings)k(of)h(the)g(W)-5
b(inter)28 b(USENIX)f(Confer)m(ence)p Fr(,)i(Jan-)2379
1786 y(uary)19 b(1994.)1992 1952 y([Gray93])80 b(Jim)41
b(Gray)f(and)g(Andreas)g(Reuter)-5 b(.)40 b Fl(T)-5 b(r)o(ansaction)
2379 2051 y(Pr)l(ocessing)o(,)35 b(Concepts)d(and)g(T)-8
b(ec)o(hnolo)o(gy)p Fr(.)30 b(Mor)n(-)2379 2151 y(gan)19
b(Kaufmann.)f(1993.)1992 2317 y([Hardy85])38 b(Norman)25
b(Hardy)-5 b(.)26 b(\223The)g(K)n(e)o(yK)n(OS)g(Architecture\224)2379
2417 y Fl(Oper)o(ating)i(Systems)h(Re)o(vie)o(w)p Fr(.)g(Oct.)g(1985,)h
(pp)f(8-)2379 2516 y(25.)1992 2682 y([Landau92])37 b(Charles)23
b(R.)g(Landau.)e(\223The)h(Checkpoint)e(Mech-)2379 2782
y(anism)30 b(in)h(K)n(e)o(yK)n(OS,)-6 b(\224)30 b Fl(Pr)l(oceedings)g
(of)g(the)h(Sec-)2379 2882 y(ond)19 b(International)f(W)-8
b(orkshop)20 b(on)g(Object)g(Orien-)2379 2981 y(tation)15
b(in)i(Oper)o(ating)d(Systems)p Fr(.)j(IEEE.)e(September)2379
3081 y(1992.)j(pp)i(86-91.)1992 3247 y([Liedtk)o(e93])38
b(Jochen)29 b(Liedtk)o(e.)f(\223Impro)o(ving)e(IPC)k(by)f(K)n(ernel)
2379 3347 y(Design,)-6 b(\224)26 b Fl(Pr)l(oceedings)e(of)i(the)f(14th)
g(Symposium)2379 3446 y(on)41 b(Oper)o(ating)f(System)i(Principles)p
Fr(.)f(Ashe)n(ville,)2379 3546 y(N.C.,)20 b(IEEE,)g(1993.)1992
3712 y([Shap96a])43 b(Jonathan)30 b(S.)i(Shapiro.)e Fl(A)h(Pr)l(o)o(gr)
o(ammer')m(s)g(Intr)l(o-)2379 3812 y(duction)41 b(to)i(ER)m(OS)p
Fr(.)f(A)-6 b(v)n(ailable)42 b(via)h(the)g(ER)m(OS)2379
3911 y(home)19 b(page)h(at)2379 4011 y Fb
(http://www.cis.upenn.edu/\230eros)1992 4177 y Fr([Shap96b])38
b(Jonathan)19 b(S.)j(Shapiro.)d Fl(The)i(ER)m(OS)f(Object)h(Refer)n(-)
2379 4276 y(ence)i(Manual)p Fr(.)g(In)g(progress.)g(Draft)g(a)n(v)n
(ailable)h(via)2379 4376 y(the)c(ER)m(OS)h(home)e(page)g(at)2379
4476 y Fb(http://www.cis.upenn.edu/\230eros)p eop
%%Page: 10 11
10 10 bop 0 -199 a Fh(REFERENCES)3296 b Fr(10)0 755 y
Fb(while)49 b(\(depth)g(<)g(MAX_DEPTH\))f({)100 855 y(Word)h(seg-)0
955 y(Blss)g(=)h(pSegKey-)0 1054 y(>blss;)100 1154 y(if)f(\(pSegKey-)0
1254 y(>readOnly)f(&&)i(writeAccess\))199 1353 y
(SEGFAULT\(FC_SegAccess\);)100 1552 y(pSegKey-)0 1652
y(>Prepare\(\);)100 1752 y(De-)0 1851 y(pend::AddKey\(pSegKey,)c
(thePTE\);)100 2051 y(//)j(The)g(last)g(key)h(might)f(be)g(a)h(page)f
(key:)100 2150 y(if)g(\()h(pSegKey-)0 2250 y(>IsSegKeyType\(\))d(\))199
2349 y(pSegKey-)0 2449 y(>pObject-)0 2549 y(>PrepAsSegment\(\);)100
2748 y(if)i(\(seg-)0 2848 y(Blss)g(<=)h(target_blss\))199
2947 y(re-)0 3047 y(turn)f(pSegKey;)100 3246 y(//)g(Tra-)0
3346 y(verse)g(this)g(node:)100 3445 y(Word)g(shif-)0
3545 y(tAmt)g(=)h(seg-)0 3645 y(Blss)f(*)h(4;)100 3744
y(Word)f(ndx)g(=)h(ad-)0 3844 y(dress)f(>>)g(shiftAmt;)100
3943 y(ndx)g(&=)g(0xfu;)100 4143 y(pSegKey)f(=)i(&\(*pSegKey-)0
4242 y(>pObject\)[ndx];)100 4442 y(depth++;)0 4541 y(})402
4698 y Fr(Figure)20 b(6:)25 b(The)20 b(tra)n(v)o(ersal)g(algorithm)2112
1937 y
 13156352 9933045 0 0 13156352 9933045 startTexFig
 2112 1937 a
%%BeginDocument: CkFlow.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: CkFlow.fig
%%Creator: fig2dev Version 3.2 Patchlevel 1
%%CreationDate: Wed Oct 13 21:20:36 1999
%%For: shapj@bonzo.watson.ibm.com (Jonathan Shapiro)
%%Orientation: Portrait
%%BoundingBox: 0 0 200 151
%%Pages: 0
%%BeginSetup
%%EndSetup
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-17.0 202.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def
%%EndProlog

$F2psBegin
10 setmiterlimit
n -1000 4354 m -1000 -1000 l 4612 -1000 l 4612 4354 l cp clip
 0.06000 0.06000 sc
% Arc
7.500 slw
gs  clippath
1439 1489 m 1350 1575 l 1387 1457 l 1317 1572 l 1368 1604 l cp
clip
n 2212.5 2019.6 970.4 -27.3 -152.7 arcn
gs col-1 s gr
 gr

% arrowhead
n 1439 1489 m 1350 1575 l 1387 1457 l 1413 1473 l 1439 1489 l  cp gs 0.00 setgray ef gr  col-1 s
% Arc
gs  clippath
2858 1546 m 2925 1650 l 2817 1589 l 2915 1682 l 2957 1638 l cp
clip
n 2250.0 2259.4 909.4 -137.9 -42.1 arc
gs col-1 s gr
 gr

% arrowhead
n 2858 1546 m 2925 1650 l 2817 1589 l 2838 1568 l 2858 1546 l  cp gs 0.00 setgray ef gr  col-1 s
% Arc
gs  clippath
2817 2686 m 2925 2625 l 2858 2729 l 2957 2637 l 2915 2593 l cp
clip
n 2250.0 2015.6 909.4 137.9 42.1 arcn
gs col-1 s gr
 gr

% arrowhead
n 2817 2686 m 2925 2625 l 2858 2729 l 2838 2707 l 2817 2686 l  cp gs 0.00 setgray ef gr  col-1 s
% Arc
gs n 1868.8 2100.0 381.2 -100.4 100.4 arc
gs col-1 s gr
 gr

% Polyline
n 300 2400 m 1650 2400 l 1650 2700 l 300 2700 l cp gs col-1 s gr 
% Polyline
n 300 1500 m 1650 1500 l 1650 1800 l 300 1800 l cp gs col-1 s gr 
% Polyline
n 2700 1500 m 3600 1500 l 3600 2700 l 2700 2700 l cp gs col-1 s gr 
% Polyline
n 1575 1725 m 1800 1725 l gs col-1 s gr 
% Polyline
gs  clippath
1545 2505 m 1425 2475 l 1545 2445 l 1410 2445 l 1410 2505 l cp
clip
n 1800 2475 m 1425 2475 l gs col-1 s gr gr

% arrowhead
n 1545 2505 m 1425 2475 l 1545 2445 l 1545 2475 l 1545 2505 l  cp gs 0.00 setgray ef gr  col-1 s
/Times-Bold ff 150.00 scf sf
1050 3309 m
gs 1 -1 sc (Checkpoint) col-1 sh gr
/Times-Bold ff 150.00 scf sf
375 2625 m
gs 1 -1 sc (Home Locations) col-1 sh gr
/Times-Bold ff 150.00 scf sf
450 1725 m
gs 1 -1 sc (Checkpoint Log) col-1 sh gr
/Times-Italic ff 150.00 scf sf
1950 1575 m
gs 1 -1 sc (Pagein\(1\)) col-1 sh gr
/Times-Italic ff 150.00 scf sf
2025 975 m
gs 1 -1 sc (Pageout) col-1 sh gr
/Times-Italic ff 150.00 scf sf
1950 3150 m
gs 1 -1 sc (Pagein\(2\)) col-1 sh gr
/Times-Italic ff 150.00 scf sf
1575 2175 m
gs 1 -1 sc (Migration) col-1 sh gr
/Times-Bold ff 150.00 scf sf
3000 2025 m
gs 1 -1 sc (Main) col-1 sh gr
/Times-Bold ff 150.00 scf sf
2925 2325 m
gs 1 -1 sc (Memory) col-1 sh gr
$F2psEnd
rs

%%EndDocument

 endTexFig
 2295 3378 a Fr(Figure)g(7:)25 b(Flo)n(w)20 b(of)g(objects)g(in)h(the)f
(system)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
