<HTML>
  <HEAD>
    <TITLE>Multiboot plan</TITLE>
    <meta name="keywords" content="CapROS, Multiboot, GRUB">
  </HEAD>
  <BODY BGCOLOR="#fff0ff" text="#000000" link="#0000ee" vlink="#551a8b" alink="#ff0000">
    <center>
      <H1>A Plan for Booting CapROS using Multiboot</H1>
    </center>
    <p>
    <a href=""></a>
    </p>
    <p>
    <a href="http://sourceforge.net/mailarchive/message.php?msg_id=11700357">
    This email thread</a> suggests changing CapROS to use the
    Multiboot specification supported by the GRUB boot loader. 
    Here is how I think that can be done.
    </p>
    <p>
    First, a Multiboot header must be included on the boot volume.
    This could be right after the VolHdr. 
    It can be created by <b>mkvol</b> and updated by <b>sysgen</b>. 
    </p>
    <p>
    GRUB can locate objects to load in two ways. 
    One is via a file name. Since CapROS doesn't have a file system
    that GRUB would understand, this won't work for us. We could dummy up a 
    file system containing the few files that GRUB needs to load,
    but that would be a pain. 
    </p>
    <p>
    The other way is as absolute block numbers. Since the location
    and size of the kernel vary, the block numbers can't be
    fixed in the GRUB menu. I propose that we have a GRUB
    configuration file located at a fixed block (such as 1; the
    VolHdr is in block 0).
    GRUB can load this with the <b>configfile</b> command.
    A CapROS tool, perhaps <b>mkvol</b>, would construct the 
    configuration file using the block numbers of the kernel division
    and preloaded division(s). <b>setboot</b> would no longer be needed.
    </p>
    <p>
    Perhaps we can write to the kernel division the kernel a.out or ELF
    file (which GRUB understands) instead of the image as is now done. 
    </p>
    <p>
    I think we can drop support for booting from RAM disk. 
    </p>
    <p>
    The Multiboot specification provides some, but not all, of the information
    the kernel currently gets in the BootInfo structure. (I'm assuming that
    GRUB actually provides all the information specified as optional
    in the Multiboot specification, but I haven't verified this.)
    The following fields in BootInfo have issues:
    </p>
    <ul>
      <li>bootStartSec, isRamImage: only used during boot, not used by the kernel
      <li>memInfo: GRUB provides information on available RAM, but the
      CapROS kernel uses other memory regions, for example MI_DEVICEMEM
      and MI_BOOTROM. The kernel will have to query the BIOS
      for this information. 
      <li>divInfo (information for preloaded divisions):
      CapROS needs more information than is provided by GRUB. 
      Possibly this information can be passed to the kernel
      in the string given with the GRUB "module" command. 
      <li>consInfo: not currently used by the kernel
      <li>volFlags, iplSysId, iplKey: the kernel can get these
      from the VolHdr of the booted volume. 
    </ul>
    <hr>
<table>
<tr valign=top>
  <td width=92>
<a href="http://sourceforge.net"><img src="http://sourceforge.net/sflogo.php?group_id=132228&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo" /></a>
  </td>
  <td>
    Authored by Charles Landau. <br>
      <em>Copyright 2005 by Strawberry Development Group.  All rights reserved.
      For terms of redistribution, see the <a
      href="./legal/license/GPL.html">GNU General Public License</a></em>
   </td>
</tr>
</table>
  </BODY>
</html>
